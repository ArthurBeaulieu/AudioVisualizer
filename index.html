<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MzkVisualizer 0.8</title>
  <link rel="stylesheet" href="css/mzkvisualizer.css">
  <!-- Style rules only needed for demo, no need to copy those in your project -->
  <style>
* { box-sizing: border-box; margin: 0; }
body { font-family: sans-serif; overflow: auto; margin-bottom: 10px; padding: 0; position: absolute; width: 100%; }
h1, h3 { margin: 10px 0; }
audio { position: fixed; right: 0; top: 0; }
.mzkvisualizer-demo { align-items: center; display: flex; flex-direction: column; font-size: 1em; }
  </style>
</head>
<!--


MzkVisualizer 0.8 - 2020
@author Arthur Beaulieu - https://github.com/ArthurBeaulieu

To use MzkVisualizer as an ES6 Module, you must ensure that assets, css and js
folder keep the same tree structure (or change yourself pathes in classes).


-->
<body>
  <div class="mzkvisualizer-demo">
    <!-- For any visual component you want to use, you must provide an HTML element to render in -->
    <!-- Each component has its own optional options (refer to each component instanciation in this example) -->
    <!-- Exotic heights are used on purpose to demonstrate dynamic dimension scaling of each component -->
    <h1>MzkVisualizer</h1>
    <button id="demo-change-src">Change source</button>
    <h3>Signal peak meter (horizontal)</h3>
    <div id="render-peakmeter-horizontal-to" style="height:86px;width:90%;"></div> <!-- Best to have even height -->
    <h3>Signal waveform (seek audio)</h3>
    <div id="render-waveformprogress-to" style="height:calc(9em - 8px);width:90%;"></div>
    <h3>Signal spectrum</h3>
    <div id="render-spectrum-to" style="height:calc(13em - 2px);width:90%;"></div>
    <h3>Signal oscilloscope</h3>
    <div id="render-oscilloscope-to" style="height:calc(17em - 8px);width:90%;"></div>
    <h3>Signal frequencies (bars)</h3>
    <div id="render-frequencybars-to" style="height:calc(17em - 8px);width:90%;"></div>
    <h3>Signal frequencies (circle)</h3>
    <div id="render-frequencycircle-to" style="height:calc(37em);width:90%;"></div>
  </div>
  <!-- MzkVisualizer also need an HTML audio tag to rely on for computation. -->
  <!-- Module tested for mp3, ogg, flac and wav audio files. -->
  <audio id="audio-player" src="assets/audio/FrequencyTest.flac" controls loop></audio>
  <!-- Usage as a JavaScript module -->
  <script type="module">
    import MzkVisualizer from './js/MzkVisualizer.js';

    const peakMeter = new MzkVisualizer({
      type: 'peakmeter', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-peakmeter-horizontal-to'), // Mandatory, the HTML div to render component
      fftSize: 8192, // Optional (default 1024), Higher is smoother for peakmeter (doesn't consume much CPU)
      merged: false, // Optional (default false), Mix channel into single output
      orientation: 'horizontal', // Optional (default horizontal), 'vertical' or 'horizontal'
      legend: { // Optional (default true), Peakmeter label
        dbScaleMin: 60, // Optional (default 60), The min db attenuation value to display
        dbScaleTicks: 6 // Optional (default 15), The space between ticks, must be a multiple of scale min
      },
      colors: { // Optional
        background: '#1D1E25', // (default #1D1E25)
        min: '#56D45B', // (default #56D45B)
        step0: '#AFF2B3', // (default #AFF2B3)
        step1: '#FFAD67', // (default #FFAD67)
        step2: '#FF6B67', // (default #FF6B67)
        max: '#FFBAB8' // (default #FFBAB8)
      }
    });

    const waveformProgress = new MzkVisualizer({
      type: 'waveformprogress', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-waveformprogress-to'), // Mandatory, the HTML div to render component
      fftSize: 1024, // Optional (default 1024), Higher is smoother for vuemeter (doesn't consume much CPU)
      merged: true,// Optional (default false), merge left/right channel into one
      animation: 'fade', // Optional (default fade), 'fade' or 'gradient', the animation on bar on progress
      colors: { // Optional
        background: '#1D1E25', // (default #1D1E25)
        track: '#E7E9E7', // (default #E7E9E7)
        progress: '#56D45B' // (default #56D45B)
      }
    });

    const spectrum = new MzkVisualizer({
      type: 'spectrum', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-spectrum-to'), // Mandatory, the HTML div to render component
      fftSize: 2048, // Optional (default 1024), Higher fft values are best fullscreen, heavy CPU cost
      merged: true,// Optional (default false), merge left/right channel into one
      colorSmoothing: true, // Optional (default true), Apply gradient between samples to smoothen visualization, uneffective on linear scale
      scale: 'logarithmic' // Optional (default linear), 'linear' or 'logarithmic', the scale to display spectrum
    });

    const oscilloscope = new MzkVisualizer({
      type: 'oscilloscope', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-oscilloscope-to'), // Mandatory, the HTML div to render component
      fftSize: 4096, // Optional (default 1024), Higher is more precise for oscilloscope, doesn't consume much CPU
      merged: false,// Optional (default false), merge left/right channel into one
      colors: { // Optional
        background: '#1D1E25', // (default #1D1E25)
        signal: '#56D45B' // (default #56D45B)
      }
    });

    const frequencyBars = new MzkVisualizer({
      type: 'frequencybars', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-frequencybars-to'), // Mandatory, the HTML div to render component
      fftSize: 1024, // Optional (default 1024), FFT values higher than width may give artifacts.
      color: '#56D45B', // Optional (default '#56D45B'), The bars color
      colors: { // Optional
        background: '#1D1E25', // (default #1D1E25)
        min: '#56D45B', // (default #56D45B)
        step0: '#AFF2B3', // (default #AFF2B3)
        step1: '#FFAD67', // (default #FFAD67)
        step2: '#FF6B67', // (default #FF6B67)
        max: '#FFBAB8' // (default #FFBAB8)
      }
    });

    const frequencyCircle = new MzkVisualizer({
      type: 'frequencycircle', // Mandatory, either 'frequencybars', 'frequencycircle', 'oscilloscope', 'peakmeter', 'spectrum' or 'waveformprogress'
      player: document.querySelector('#audio-player'), // Mandatory, the play to wire visualisation to
      renderTo: document.querySelector('#render-frequencycircle-to'), // Mandatory, the HTML div to render component
      fftSize: 512, // Optional (default 1024), high FFT values can have a high impact on CPU load
      image: 'assets/img/manazeak-logo-small.svg' // Optional (default 'assets/img/manazeak-logo-small.svg'), the logo to put inside main circle
    });

    // You can can call delete on those components when done consuming them
    // peakMeter.destroy();
    // waveformProgress.destroy();
    // spectrum.destroy();
    // oscilloscope.destroy();
    // frequencyBars.destroy();
    // frequencyCircle.destroy();

    /* Following code only concerns the demo */
    const sources = ['FrequencyTest.wav', 'FrequencyTest.flac', 'FrequencyTest.ogg', 'FrequencyTest.mp3'];
    let currentIndex = 2;
    const changeSrc = document.getElementById('demo-change-src');
    changeSrc.addEventListener('click', () => {
      document.getElementById('audio-player').src = `assets/audio/${sources[currentIndex]}`;
      currentIndex = (currentIndex + 1) % sources.length;
    });
  </script>
</body>
</html>
