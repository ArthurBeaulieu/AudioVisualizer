window.AudioVisualizer=function(){"use strict";var t={608:function(t,e,i){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}i.d(e,{default:function(){return Pt}});var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._type=null,this._player=null,this._renderTo=null,this._fftSize=null,this._audioCtx=null,this._inputNode=null,this._isPlaying=!1,this._dom={container:null},this._parentDimension={position:null,height:null,width:null,zIndex:null},this._resizeObserver=null,this._onResize=this._onResize.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._dblClick=this._dblClick.bind(this),this._processAudioBin=this._processAudioBin.bind(this)}var e,i;return e=t,(i=[{key:"destroy",value:function(){var t=this;this._removeEvents(),Object.keys(this).forEach((function(e){delete t[e]}))}},{key:"_fillAttributes",value:function(){}},{key:"_buildUI",value:function(){}},{key:"_setAudioNodes",value:function(){}},{key:"_processAudioBin",value:function(){}},{key:"_addEvents",value:function(){this._resizeObserver=new ResizeObserver(this._onResize),this._resizeObserver.observe(this._renderTo),this._player.addEventListener("play",this._play,!1),this._player.addEventListener("pause",this._pause,!1),this._dom.container.addEventListener("dblclick",this._dblClick,!1)}},{key:"_removeEvents",value:function(){this._resizeObserver.disconnect(),this._player.removeEventListener("play",this._play,!1),this._player.removeEventListener("pause",this._pause,!1),this._dom.container.removeEventListener("dblclick",this._dblClick,!1)}},{key:"_play",value:function(){this._isPlaying=!0,this._processAudioBin()}},{key:"_pause",value:function(){this._isPlaying=!1}},{key:"_onResize",value:function(){}},{key:"_dblClick",value:function(){var t=this;document.fullscreenElement?document.exitFullscreen().then((function(){t._renderTo.style.position=t._parentDimension.position,t._renderTo.style.height=t._parentDimension.height,t._renderTo.style.width=t._parentDimension.width,t._renderTo.style.zIndex=t._parentDimension.zIndex,t._parentDimension={position:null,height:null,width:null,zIndex:null}})):document.documentElement.requestFullscreen().then((function(){t._parentDimension={position:t._renderTo.style.position,height:t._renderTo.style.height,width:t._renderTo.style.width,zIndex:t._renderTo.style.zIndex||""},t._renderTo.style.position="fixed",t._renderTo.style.height="100vh",t._renderTo.style.width="100vw",t._renderTo.style.zIndex="999"}))}},{key:"_clearCanvas",value:function(){}}])&&n(e.prototype,i),t}();function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(c,t);var e,i,n,o,a=(n=c,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=h(n);if(o){var i=h(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return l(this,t)});function c(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(e=a.call(this))._nodes={source:null,analyser:null},e._canvas=null,e._ctx=null,e._fillAttributes(t),e._buildUI(),e._setAudioNodes(),e._addEvents(),e}return e=c,(i=[{key:"_fillAttributes",value:function(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize,this._audioCtx=t.audioContext,this._inputNode=t.inputNode}},{key:"_buildUI",value:function(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-".concat(this._type)),this._canvas=document.createElement("CANVAS"),this._canvas.style.cssText="background-color:black;border:solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctx=this._canvas.getContext("2d"),this._ctx.translate(.5,.5),this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2,this._dom.container.appendChild(this._canvas),this._renderTo.appendChild(this._dom.container)}},{key:"_setAudioNodes",value:function(){var t=!1;this._audioCtx?(t=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player)),this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),t||this._nodes.analyser.connect(this._audioCtx.destination)}},{key:"_onResize",value:function(){this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2}},{key:"_clearCanvas",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._canvas.width,this._canvas.height)}}])&&r(e.prototype,i),c}(o);function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"drawRadialGradient",value:function(t,e){for(var i=t.getContext("2d"),n=i.createRadialGradient(e.x0,e.y0,e.r0,e.x1,e.y1,e.r1),o=0;o<e.colors.length;++o)n.addColorStop(e.colors[o].index,e.colors[o].color);i.fillStyle=n,i.fillRect(0,0,t.width,t.height)}},{key:"radialGlowGradient",value:function(t,e){for(var i=t.getContext("2d").createRadialGradient(e.centerX,e.centerY,0,e.centerX,e.centerY,e.radius),n=0;n<e.colors.length;++n)i.addColorStop(e.colors[n].index,e.colors[n].color);return i}},{key:"linearGradient",value:function(t,e){var i=t.getContext("2d"),n=i.createLinearGradient(0,0,t.width,0);!0===e.vertical&&(n=i.createLinearGradient(0,t.height,0,0));for(var o=0;o<e.colors.length;++o)n.addColorStop(e.colors[o].index,e.colors[o].color);return n}},{key:"rainbowLinearGradient",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==e?new Error("ColorUtils.rainbowLinearGradient : Missing arguments canvas"):"CANVAS"!==e.nodeName||"boolean"!=typeof i?new Error("ColorUtils.rainbowLinearGradient : Invalid type for canvas or vertical"):t.linearGradient(e,{vertical:i,colors:[{color:"red",index:0},{color:"orange",index:1/7},{color:"yellow",index:2/7},{color:"green",index:3/7},{color:"blue",index:4/7},{color:"indigo",index:5/7},{color:"violet",index:6/7},{color:"red",index:1}]})}},{key:"lightenDarkenColor",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.lightenDarkenColor : Missing arguments color or amount");if("string"!=typeof t||"number"!=typeof e)return new Error("ColorUtils.lightenDarkenColor : Invalid type for color or amount");var i=!1;if("#"===t[0]&&(t=t.slice(1),i=!0),!/^[a-fA-F0-9]+$/i.test(t))return new Error("ColorUtils.lightenDarkenColor : Color is not a valid hexadecimal value");if(e<-100)e=-100;else if(e>100)e=100;else if(0===e)return(i?"#":"")+t.toLowerCase();e>0?e+=16:e-=16;var n=parseInt(t,16),o=(n>>16)+e;o>255?o=255:o<0&&(o=0);var a=(n>>8&255)+e;a>255?a=255:a<0&&(a=0);var r=(255&n)+e;return r>255?r=255:r<0&&(r=0),(i?"#":"")+(r|a<<8|o<<16).toString(16)}},{key:"alphaColor",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.alphaColor : Missing arguments color or alpha");if("string"!=typeof t||"number"!=typeof e)return new Error("ColorUtils.alphaColor : Invalid type for color or alpha");if("#"===t[0]&&(t=t.slice(1)),!/^[a-fA-F0-9]+$/i.test(t))return new Error("ColorUtils.alphaColor : Color is not a valid hexadecimal value");e<0?e=0:e>1&&(e=1);var i=parseInt(t,16);return"rgba(".concat(i>>16,", ").concat(i>>8&255,", ").concat(255&i,", ").concat(e,")")}},{key:"defaultBackgroundColor",get:function(){return"#1D1E25"}},{key:"defaultTextColor",get:function(){return"#E7E9E7"}},{key:"defaultPrimaryColor",get:function(){return"#56D45B"}},{key:"defaultAntiPrimaryColor",get:function(){return"#FF6B67"}},{key:"defaultDarkPrimaryColor",get:function(){return"#12B31D"}},{key:"defaultLoopColor",get:function(){return"#FFAD67"}},{key:"defaultLoopAlphaColor",get:function(){return this.alphaColor("FFAD67",.5)}},{key:"defaultAudioGradient",get:function(){return[{color:"#56D45B",index:0},{color:"#AFF2B3",index:.7},{color:"#FFAD67",index:.833},{color:"#FF6B67",index:.9},{color:"#FFBAB8",index:1}]}}],null&&u(e.prototype,null),i&&u(e,i),t}();function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"drawRadialBar",value:function(t,e){var i=t.getContext("2d"),n=e.frequencyValue/255;n<.05?n=-n:n*=1.33,i.beginPath(),i.moveTo(e.x0,e.y0),i.lineTo(e.x1,e.y1),i.strokeStyle=_.lightenDarkenColor(e.color,100*n),i.lineWidth=e.width,i.stroke(),i.closePath()}},{key:"drawCircle",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.lineWidth=e.width,i.strokeStyle=e.color,i.stroke(),i.closePath()}},{key:"drawCircleGlow",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.fillStyle=_.radialGlowGradient(t,e),i.fill(),i.closePath()}},{key:"drawDisc",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.fillStyle=e.color,i.fill(),i.closePath()}},{key:"drawVerticalBar",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.fillRect(e.originX,t.height-e.height,e.width,e.height),e.vertical=!0,i.fillStyle=_.linearGradient(t,e),i.fillRect(e.originX,t.height-e.height,e.width,e.height),i.closePath()}},{key:"drawOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath();for(var n=0,o=t.width/e.samples,a=0;a<e.samples;++a){var r=e.timeDomain[a]/255,s=t.height*r;a>0?i.lineTo(n,s):i.moveTo(n,s),n+=o}"rainbow"===e.colors?i.strokeStyle=_.rainbowLinearGradient(t):Array.isArray(e.colors)?i.strokeStyle=_.linearGradient(t,e):i.strokeStyle=e.colors,i.stroke(),i.closePath()}},{key:"drawPointsOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath();for(var n=0;n<e.length;++n){var o=t.height*(e.times[n]/255),a=t.height-o-1,r=t.width/e.length;i.fillStyle=e.color,i.fillRect(n*r,a,2,2)}i.stroke(),i.fill(),i.closePath()}},{key:"drawRadialOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.save(),i.translate(e.centerX,e.centerY),i.rotate(e.rotation),i.translate(-e.centerX,-e.centerY),i.moveTo(e.points[0].dx,e.points[0].dy),i.strokeStyle=e.color;for(var n=0;n<e.length-1;++n){var o=e.points[n];o.dx=o.x+e.times[n]*Math.sin(Math.PI/180*o.angle),o.dy=o.y+e.times[n]*Math.cos(Math.PI/180*o.angle);var a=(o.dx+e.points[n+1].dx)/2,r=(o.dy+e.points[n+1].dy)/2;i.quadraticCurveTo(o.dx,o.dy,a,r)}var s=e.times[e.length-1],l=e.points[e.length-1];l.dx=l.x+s*Math.sin(Math.PI/180*l.angle),l.dy=l.y+s*Math.cos(Math.PI/180*l.angle);var h=(l.dx+e.points[0].dx)/2,c=(l.dy+e.points[0].dy)/2;i.quadraticCurveTo(l.dx,l.dy,h,c),i.quadraticCurveTo(h,c,e.points[0].dx,e.points[0].dy),i.lineWidth=1,i.lineCap="round",i.stroke(),i.restore(),i.closePath()}},{key:"drawPeakMeter",value:function(t,e){var i=t.getContext("2d");if(e.vertical="vertical"===e.orientation,i.fillStyle=_.linearGradient(t,e),i.fill(),"horizontal"===e.orientation){var n=t.width-e.amplitude;i.fillRect(0,0,n,t.height)}else if("vertical"===e.orientation){var o=t.height-e.amplitude;i.fillRect(0,t.height-o,t.width,o)}if(i.fillStyle="#FF6B67","horizontal"===e.orientation){var a=t.width-e.peak;i.fillRect(a,0,1,t.height)}else if("vertical"===e.orientation){var r=t.height-e.peak;i.fillRect(0,t.height-r,t.width,1)}}},{key:"drawTriangle",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.moveTo(e.x-e.radius,e.y),i.lineTo(e.x+e.radius,e.y),i.lineTo(e.x,e.top),i.fill(),i.closePath()}},{key:"drawHotCue",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.fillStyle=_.defaultBackgroundColor,i.fillRect(e.x-e.size/2-1,e.y-1,e.size+2,e.size+2),i.fillStyle=e.color||_.defaultPrimaryColor,i.fillRect(e.x-e.size/2,e.y,e.size,e.size),i.fillStyle=_.defaultBackgroundColor,i.font="bold 8pt sans-serif",i.textAlign="center",i.fillText(e.label||"",e.x,e.y+3*e.size/4),i.closePath()}},{key:"drawBeatCount",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.fillStyle=_.defaultPrimaryColor,i.font="bold 10pt sans-serif",i.textAlign="left",i.fillText("".concat(e.label," Bars"),e.x,e.y),i.closePath()}},{key:"precisionRound",value:function(t,e){var i=Math.pow(10,e||0);return Math.round(t*i)/i}}],null&&d(e.prototype,null),i&&d(e,i),t}();function p(t){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function g(t,e){return!e||"object"!==p(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=m(n);if(o){var i=m(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return g(this,t)});function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),e=a.call(this,t),t.colors&&t.colors.gradient?e._barGradient=t.colors.gradient:e._barGradient=_.defaultAudioGradient,e._canvas.style.backgroundColor=t.colors&&t.colors.background||_.defaultBackgroundColor,e}return e=r,(i=[{key:"_processAudioBin",value:function(){if(!0===this._isPlaying){this._clearCanvas();var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t);for(var e=this._canvas.width/this._nodes.analyser.frequencyBinCount,i=0,n=0;n<this._nodes.analyser.frequencyBinCount;++n){var o=t[n]/255*this._canvas.height;f.drawVerticalBar(this._canvas,{height:o,width:e,colors:this._barGradient,originX:i}),i+=e}requestAnimationFrame(this._processAudioBin)}}}])&&y(e.prototype,i),r}(c);function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function w(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function x(t,e,i){return e&&k(t.prototype,e),i&&k(t,i),t}function S(t,e,i){return(S="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=L(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(o,t);var e,i,n=(e=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=L(e);if(i){var o=L(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return P(this,t)});function o(t){return w(this,o),n.call(this,t)}return x(o,[{key:"_fillAttributes",value:function(t){S(L(o.prototype),"_fillAttributes",this).call(this,t),this._imageSrc=null,this._centerX=null,this._centerY=null,this._radius=null,this._radialSection=null,this._barCount=null,this._barMaxHeight=null,this._circleStrokeWidth=null,this._stars=[],this._points=[],this._oscilloscopeRotation=null,this._dom.logo=null,this._averageBreakpoint=132,this._averageHit=!1,this._imageSrc=t.image,this._dom.logo=document.createElement("IMG"),this._dom.logo.classList.add("paused"),this._dom.logo.src=this._imageSrc}},{key:"_buildUI",value:function(){S(L(o.prototype),"_buildUI",this).call(this),this._imageSrc&&this._dom.container.appendChild(this._dom.logo),this._buildBackgroundBase()}},{key:"_play",value:function(){S(L(o.prototype),"_play",this).call(this),this._dom.logo.classList.remove("paused")}},{key:"_pause",value:function(){S(L(o.prototype),"_pause",this).call(this),this._dom.logo.classList.add("paused")}},{key:"_onResize",value:function(){S(L(o.prototype),"_onResize",this).call(this),this._circleStrokeWidth=2,this._barCount=this._nodes.analyser.frequencyBinCount,this._centerX=this._canvas.width/2,this._centerY=this._canvas.height/2,this._barMaxHeight=this._canvas.height/8,this._radius=this._canvas.height/4-this._canvas.height/16,this._radialSection=2*Math.PI/this._barCount,this._stars=[];for(var t=0;t<1500;++t)this._stars.push(new A(this._centerX,this._centerY,null,this._averageBreakpoint));this._points=[];for(var e=0;e<this._fftSize/2;++e)this._points.push(new E({index:e,height:this._canvas.height,width:this._canvas.width,total:this._fftSize/2}));this._buildBackgroundBase()}},{key:"_processAudioBin",value:function(){if(!0===this._isPlaying){this._clearCanvas(),this._buildBackgroundBase();var t=new Uint8Array(this._nodes.analyser.frequencyBinCount),e=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._nodes.analyser.getByteTimeDomainData(e);var i=this._getAverageFrequency(t);this._averageHit=i>this._averageBreakpoint,this._animateCircleBars(t),this._animateStars(i),this._animateCircleGlow(i),this._animateOscilloscopes(e),requestAnimationFrame(this._processAudioBin)}}},{key:"_buildBackgroundBase",value:function(){_.drawRadialGradient(this._canvas,{x0:this._centerX,y0:this._centerY,r0:this._radius,x1:this._centerX,y1:this._centerY,r1:this._canvas.width/2.66,colors:[{color:"#3C405D",index:0},{color:"#060609",index:1}]}),f.drawCircle(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:this._radius,radStart:0,radEnd:2*Math.PI,width:2*this._circleStrokeWidth})}},{key:"_animateCircleBars",value:function(t){for(var e=Math.round(this._radialSection*this._radius),i=0;i<t.length;++i){var n=t[i]/255*this._barMaxHeight;f.drawRadialBar(this._canvas,{frequencyValue:t[i],x0:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),y0:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),x1:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+n),y1:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+n),width:e,color:this._averageHit?"#56D45B":"#37C340"})}}},{key:"_animateStars",value:function(t){for(var e=this._averageHit?t/20:t/60,i=0;i<this._stars.length;++i){var n=this._stars[i];n.updatePosition(e,.6),(n.x<-this._centerX||n.x>this._centerX||n.y<-this._centerY||n.y>this._centerY)&&(n=new A(this._centerX,this._centerY,t,this._averageBreakpoint),this._stars[i]=n),f.drawDisc(this._canvas,{centerX:n.x+this._centerX,centerY:n.y+this._centerY,radius:n.radius,radStart:2*Math.PI,radEnd:!1,color:n.color})}}},{key:"_animateCircleGlow",value:function(t){f.drawCircleGlow(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:2*(1.33*this._radius+t),radStart:0,radEnd:2*Math.PI,colors:[{color:"rgba(0, 0, 0, 0)",index:.48},{color:this._averageHit?"#56D45B":"#48ABAF",index:.5},{color:"rgba(0, 0, 0, 0)",index:.52}]})}},{key:"_animateOscilloscopes",value:function(t){var e="#FFF";this._averageHit?(this._oscilloscopeRotation+=.05,e="rgba(255, 193, 140, .7)"):(this._oscilloscopeRotation+=-.05,e="rgba(125, 228, 132, 0.25)"),f.drawRadialOscilloscope(this._canvas,{points:this._points,times:t,length:this._fftSize/2,centerX:this._centerX,centerY:this._centerY,rotation:this._oscilloscopeRotation,color:e}),this._averageHit&&f.drawPointsOscilloscope(this._canvas,{times:t,length:this._fftSize/2,color:"rgba(113, 201, 205, .7)"})}},{key:"_getAverageFrequency",value:function(t){for(var e=0,i=0;i<t.length;++i)e+=t[i];return e/t.length}}]),o}(c),A=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:132;w(this,t),this.radius=.4,this.color="#0F8489",this.x=Math.random()*(2*e)-e,this.y=Math.random()*(2*i)-i,this._z=Math.max(2*e/(2*i)),this._maxDepth=Math.max(2*e/(2*i)),Math.abs(this.x)>Math.abs(this.y)?(this._dx=1,this._dy=Math.abs(this.y/this.x)):(this._dx=Math.abs(this.x/this.y),this._dy=1),this._dx*=this.x>0?1:-1,this._dy*=this.y>0?1:-1,this._dz=-.1,this.y>i/2?this.color="#71C9CD":n>o&&(this.color="#FF6B67")}return x(t,[{key:"updatePosition",value:function(t,e){this.x+=this._dx*t,this.y+=this._dy*t,this._z+=this._dz,this._dx+=.001*this._dx,this._dy+=.001*this._dy,this.radius=e+.1*(this._maxDepth-this._z)}}]),t}(),E=function t(e){w(this,t),this._height=e.height,this._width=e.width,this._total=e.total,this._index=e.index,this._value=256*Math.random(),this._radius=Math.abs(this._width)/8,this.angle=360*this._index/this._total,this.x=this._width/2+this._radius*Math.sin(Math.PI/180*this.angle),this.y=this._height/2+this._radius*Math.cos(Math.PI/180*this.angle),this.dx=this.x+this._value*Math.sin(Math.PI/180*this.angle),this.dy=this.y+this._value*Math.cos(Math.PI/180*this.angle)},O=T;function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function D(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function M(t,e){return(M=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function j(t,e){return!e||"object"!==B(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function I(t){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=I(n);if(o){var i=I(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return j(this,t)});function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=a.call(this))._merged=null,e._nodes={source:null,splitter:null,merger:null,analyser:null,analyserL:null,analyserR:null},e._canvasL=null,e._canvasR=null,e._ctxL=null,e._ctxR=null,e._fillAttributes(t),e._buildUI(),e._setAudioNodes(),e._addEvents(),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize||1024,this._audioCtx=t.audioContext,this._inputNode=t.inputNode,this._merged=t.merged||!1}},{key:"_buildUI",value:function(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-".concat(this._type)),this._canvasL=document.createElement("canvas"),this._canvasR=document.createElement("canvas"),this._canvasL.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._canvasR.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctxL=this._canvasL.getContext("2d"),this._ctxR=this._canvasR.getContext("2d"),this._ctxL.translate(.5,.5),this._ctxR.translate(.5,.5),this._dom.container.appendChild(this._canvasL),this._dom.container.appendChild(this._canvasR),this._renderTo.appendChild(this._dom.container)}},{key:"_setAudioNodes",value:function(){var t,e=!1;if(this._audioCtx?(e=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player)),!0===this._merged?(this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),t=this._nodes.analyser):(this._nodes.splitter=this._audioCtx.createChannelSplitter(this._nodes.source.channelCount),this._nodes.merger=this._audioCtx.createChannelMerger(this._nodes.source.channelCount),this._nodes.analyserL=this._audioCtx.createAnalyser(),this._nodes.analyserR=this._audioCtx.createAnalyser(),this._nodes.analyserR.fftSize=this._fftSize,this._nodes.analyserL.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.splitter),this._nodes.splitter.connect(this._nodes.analyserL,0),this._nodes.splitter.connect(this._nodes.analyserR,1),this._nodes.analyserL.connect(this._nodes.merger,0,0),this._nodes.analyserR.connect(this._nodes.merger,0,1),t=this._nodes.merger),e){var i=this._audioCtx.createGain();i.gain.value=0,t.connect(i),i.connect(this._audioCtx.destination)}else t.connect(this._audioCtx.destination)}},{key:"_clearCanvas",value:function(){this._canvasL.getContext("2d").clearRect(0,0,this._canvasL.width,this._canvasL.height),this._canvasR.getContext("2d").clearRect(0,0,this._canvasR.width,this._canvasR.height)}}])&&D(e.prototype,i),r}(o);function H(t){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function q(t,e,i){return(q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=W(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function U(t,e){return!e||"object"!==H(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function W(t){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var X=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=W(n);if(o){var i=W(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return U(this,t)});function r(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=a.call(this,t))._colors={signal:_.defaultPrimaryColor},t.colors&&t.colors.signal&&(e._colors.signal=t.colors.signal);var i=t.colors&&t.colors.background||_.defaultBackgroundColor;return!0===e._merged?e._canvas.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e._updateDimensions(),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){q(W(r.prototype),"_fillAttributes",this).call(this,t),this._dimension={height:null,canvasHeight:null,width:null}}},{key:"_buildUI",value:function(){q(W(r.prototype),"_buildUI",this).call(this),!0===this._merged&&this._dom.container.removeChild(this._canvasR)}},{key:"_onResize",value:function(){q(W(r.prototype),"_onResize",this).call(this),this._updateDimensions()}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteTimeDomainData(t),f.drawOscilloscope(this._canvasL,{samples:this._nodes.analyser.frequencyBinCount,timeDomain:t,colors:this._colors.signal})}},{key:"_stereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyserL.frequencyBinCount);this._nodes.analyserL.getByteTimeDomainData(t),f.drawOscilloscope(this._canvasL,{samples:this._nodes.analyserL.frequencyBinCount,timeDomain:t,colors:this._colors.signal}),this._nodes.analyserR.getByteTimeDomainData(t),f.drawOscilloscope(this._canvasR,{samples:this._nodes.analyserR.frequencyBinCount,timeDomain:t,colors:this._colors.signal})}},{key:"_updateDimensions",value:function(){this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.width=this._renderTo.offsetWidth-2,this._dimension.canvasHeight=this._dimension.height/2,!0===this._merged?(this._canvasL.width=this._dimension.width,this._canvasL.height=2*this._dimension.canvasHeight):(this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight)}}])&&F(e.prototype,i),r}(z);function Y(t){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function N(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function V(t,e,i){return(V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=K(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function $(t,e){return($=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function J(t,e){return!e||"object"!==Y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function K(t){return(K=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Q=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=K(n);if(o){var i=K(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return J(this,t)});function r(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),e=a.call(this,t),t.colors&&t.colors.gradient?e._peakGradient=t.colors.gradient:e._peakGradient=_.defaultAudioGradient;var i=t.colors&&t.colors.background||_.defaultBackgroundColor;return!0===e._merged?e._canvasL.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){V(K(r.prototype),"_fillAttributes",this).call(this,t),this._orientation=t.orientation||"horizontal",this._legend=t.legend||null,this._legend?(this._dbScaleMin=t.legend.dbScaleMin||60,this._dbScaleTicks=t.legend.dbScaleTicks||15):(this._dbScaleMin=60,this._dbScaleTicks=15),this._amplitudeL=0,this._amplitudeR=0,this._peakL=0,this._peakR=0,this._peakSetTimeL=null,this._peakSetTimeR=null,this._dom.scaleContainer=null,this._dom.labels=[]}},{key:"_buildUI",value:function(){V(K(r.prototype),"_buildUI",this).call(this),"horizontal"===this._orientation&&this._dom.container.classList.add("horizontal-peakmeter"),this._legend&&(this._dom.scaleContainer=document.createElement("DIV"),this._dom.scaleContainer.classList.add("scale-container"),this._dom.container.insertBefore(this._dom.scaleContainer,this._dom.container.firstChild)),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}},{key:"_setAudioNodes",value:function(){V(K(r.prototype),"_setAudioNodes",this).call(this),this._peakSetTimeL=this._audioCtx.currentTime,this._peakSetTimeR=this._audioCtx.currentTime}},{key:"_pause",value:function(){V(K(r.prototype),"_pause",this).call(this),this._legend&&(this._dom.labels[0].textContent="-∞",this._dom.labels[1].textContent="-∞")}},{key:"_onResize",value:function(){V(K(r.prototype),"_onResize",this).call(this),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Float32Array(this._fftSize);this._nodes.analyser.getFloatTimeDomainData(t);for(var e=0,i=0;i<t.length;i++)e+=t[i]*t[i];var n=10*Math.log10(e/t.length),o=-1*this._dbScaleMin;"horizontal"===this._orientation?this._amplitudeL=Math.floor(n*this._canvasL.width/o):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(n*this._canvasL.height/o)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&n!==-1/0&&(this._dom.labels[0].textContent=f.precisionRound(n,1))),f.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient})}},{key:"_stereoAnalysis",value:function(){var t=new Float32Array(this._fftSize),e=new Float32Array(this._fftSize);this._nodes.analyserL.getFloatTimeDomainData(t),this._nodes.analyserR.getFloatTimeDomainData(e);for(var i=0,n=0,o=0;o<t.length;o++)i+=t[o]*t[o],n+=e[o]*t[o];var a=10*Math.log10(i/t.length),r=10*Math.log10(n/e.length),s=-1*this._dbScaleMin;"horizontal"===this._orientation?(this._amplitudeL=Math.floor(a*this._canvasL.width/s),this._amplitudeR=Math.floor(r*this._canvasR.width/s)):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(a*this._canvasL.height/s),this._amplitudeR=Math.floor(r*this._canvasR.height/s)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&a!==-1/0&&(this._dom.labels[0].textContent=f.precisionRound(a,1))),this._peakR>this._amplitudeR?(this._peakR=this._amplitudeR,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&r!==-1/0&&(this._dom.labels[1].textContent=f.precisionRound(r,1))):this._audioCtx.currentTime-this._peakSetTimeR>1&&(this._peakR=this._amplitudeL,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&r!==-1/0&&(this._dom.labels[1].textContent=f.precisionRound(r,1))),f.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient}),f.drawPeakMeter(this._canvasR,{amplitude:this._amplitudeR,peak:this._peakR,orientation:this._orientation,colors:this._peakGradient})}},{key:"_createScaleTicks",value:function(){var t=Math.floor(this._dbScaleMin/this._dbScaleTicks),e=0;if(this._dom.scaleContainer.innerHTML="","horizontal"===this._orientation)for(var i=this._canvasL.width/t,n=0;n<t;++n){var o=document.createElement("DIV");this._dom.scaleContainer.appendChild(o),o.style.width="".concat(i,"px"),o.textContent="".concat(e),e-=this._dbScaleTicks}else for(var a=this._canvasL.height/t,r=0;r<t;++r){var s=document.createElement("DIV");this._dom.scaleContainer.appendChild(s),s.style.height="".concat(a,"px"),s.textContent="".concat(e),e-=this._dbScaleTicks}}},{key:"_createPeakLabel",value:function(){2===this._dom.labels.length&&(this._dom.container.removeChild(this._dom.labels[0]),this._dom.container.removeChild(this._dom.labels[1]),this._dom.labels=[]);var t=document.createElement("DIV"),e=document.createElement("DIV");t.classList.add("peak-value-container"),e.classList.add("peak-value-container"),t.textContent="-∞",e.textContent="-∞","horizontal"===this._orientation?(t.style.width="28px",t.style.height="".concat(this._canvasL.height+2,"px"),t.style.top="14px",e.style.width="28px",e.style.height="".concat(this._canvasL.height+2,"px"),e.style.top="".concat(this._canvasL.height+16,"px")):(t.style.width="".concat(this._canvasL.width+2,"px"),t.style.left="18px",e.style.width="".concat(this._canvasL.width+2,"px"),e.style.left="".concat(this._canvasL.width+20,"px")),this._dom.labels.push(t),this._dom.labels.push(e),this._dom.container.appendChild(this._dom.labels[0]),this._dom.container.appendChild(this._dom.labels[1])}},{key:"_updateDimensions",value:function(){var t=0,e=0;"horizontal"===this._orientation?(this._legend&&(t=30,e=14),this._canvasL.width=this._renderTo.offsetWidth-t,!0===this._merged?(this._canvasL.height=this._renderTo.offsetHeight-e-2,this._canvasR.height=this._renderTo.offsetHeight-e-2):(this._canvasR.width=this._renderTo.offsetWidth-t,this._canvasL.height=(this._renderTo.offsetHeight-e)/2-2,this._canvasR.height=(this._renderTo.offsetHeight-e)/2-2),this._legend&&(this._dom.scaleContainer.style.width="".concat(this._canvasL.width,"px"))):"vertical"===this._orientation&&(this._legend?(t=18,e=16):this._canvasL.style.left="0",this._canvasL.height=this._renderTo.offsetHeight-e-2,!0===this._merged?(this._canvasL.width=this._renderTo.offsetWidth-t-2,this._canvasR.width=this._renderTo.offsetWidth-t-2):(this._canvasR.height=this._renderTo.offsetHeight-e-2,this._canvasL.width=(this._renderTo.offsetWidth-t)/2-2,this._canvasR.width=(this._renderTo.offsetWidth-t)/2-2),this._legend&&(this._dom.scaleContainer.style.height="".concat(this._canvasL.height,"px"),this._dom.scaleContainer.style.width="18px"))}}])&&N(e.prototype,i),r}(z);function Z(t){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function et(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function it(t,e,i){return(it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=at(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function nt(t,e){return(nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ot(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function at(t){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var rt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&nt(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=at(n);if(o){var i=at(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return ot(this,t)});function r(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=a.call(this,t))._updateDimensions(),e._createLogarithmicScaleHeights();var i="black";return!0===e._merged?e._canvasL.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){it(at(r.prototype),"_fillAttributes",this).call(this,t),this._scaleType=t.scale||"linear",this._colorSmoothing=t.colorSmoothing||!1,this._canvasSpeed=1,this._bufferCanvas=null,this._bufferCtx=null,this._dom.settings=null,this._dom.settingsPanel=null,this._dimension={height:null,canvasHeight:null,width:null},this._logScale=[],this._settingsClicked=this._settingsClicked.bind(this),this._clickedElsewhere=this._clickedElsewhere.bind(this)}},{key:"_buildUI",value:function(){var t=this;it(at(r.prototype),"_buildUI",this).call(this),this._bufferCanvas=document.createElement("CANVAS"),this._bufferCtx=this._bufferCanvas.getContext("2d"),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight,this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight;var e=new DOMParser;this._dom.settings=e.parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/></svg>',"image/svg+xml").documentElement,this._dom.settings.classList.add("audio-spectrum-settings"),this._dom.settingsPanel=document.createElement("DIV"),this._dom.settingsPanel.classList.add("audio-spectrum-settings-panel"),this._dom.settingsPanel.innerHTML='\n      <h3>Settings</h3>\n      <form>\n        <p class="legend">Scale:</p>\n        <label for="linear">Linear</label>\n        <input type="radio" id="id-linear" name="scale" value="linear" '.concat("linear"===this._scaleType?"checked":"",'>\n        <label for="logarithmic">Logarithmic</label>\n        <input type="radio" id="id-logarithmic" name="scale" value="logarithmic" ').concat("logarithmic"===this._scaleType?"checked":"",'>\n        <p class="smooth-color">\n          <label for="smoothColor">Smooth colors</label>\n          <input type="checkbox" id="smoothColor" name="smoothColor" ').concat(this._colorSmoothing?"checked":"",">\n        </p>\n      </form>\n    ");var i=this._dom.settingsPanel.querySelector("form");i.addEventListener("change",(function(e){e.preventDefault();var n,o=[],a=function(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return tt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?tt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){s=!0,a=t},f:function(){try{r||null==i.return||i.return()}finally{if(s)throw a}}}}(new FormData(i));try{for(a.s();!(n=a.n()).done;){var r=n.value;o.push(r[1])}}catch(t){a.e(t)}finally{a.f()}t._scaleType=o[0],t._colorSmoothing="on"===o[1]}),!1),this._dom.container.appendChild(this._dom.settingsPanel),this._dom.container.appendChild(this._dom.settings),this._dom.settings.addEventListener("click",this._settingsClicked,!1)}},{key:"_removeEvents",value:function(){it(at(r.prototype),"_removeEvents",this).call(this),document.body.removeEventListener("click",this._clickedElsewhere,!1)}},{key:"_onResize",value:function(){it(at(r.prototype),"_onResize",this).call(this),this._updateDimensions(),this._createLogarithmicScaleHeights(),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,!1===this._merged&&(this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight),this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._drawSpectrogramForFrequencyBin(this._canvasL,t)}},{key:"_stereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyserL.frequencyBinCount),e=new Uint8Array(this._nodes.analyserR.frequencyBinCount);this._nodes.analyserL.getByteFrequencyData(t),this._nodes.analyserR.getByteFrequencyData(e),this._drawSpectrogramForFrequencyBin(this._canvasL,t),this._drawSpectrogramForFrequencyBin(this._canvasR,e)}},{key:"_updateDimensions",value:function(){this._dimension.width=this._renderTo.offsetWidth-2,!0===this._merged?(this._dimension.height=this._renderTo.offsetHeight-2,this._dimension.canvasHeight=this._dimension.height):(this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.canvasHeight=this._dimension.height/2)}},{key:"_settingsClicked",value:function(){!1===this._dom.settingsPanel.classList.contains("opened")&&(this._dom.settings.classList.add("opened"),this._dom.settingsPanel.classList.add("opened"),document.body.addEventListener("click",this._clickedElsewhere,!1))}},{key:"_clickedElsewhere",value:function(t){t.target.closest(".audio-spectrum-settings")||t.target.closest(".audio-spectrum-settings-panel")||(this._dom.settings.classList.remove("opened"),this._dom.settingsPanel.classList.remove("opened"),document.body.removeEventListener("click",this._clickedElsewhere,!1))}},{key:"_drawSpectrogramForFrequencyBin",value:function(t,e){var i=t.getContext("2d");this._bufferCtx.drawImage(t,0,0,this._dimension.width,this._dimension.canvasHeight);for(var n=0;n<e.length;++n)"linear"===this._scaleType?this._fillRectLinear(i,e,n):this._fillRectLogarithm(i,e,n);i.translate(-this._canvasSpeed,0),i.drawImage(this._bufferCanvas,0,0,this._dimension.width,this._dimension.canvasHeight,0,0,this._dimension.width,this._dimension.canvasHeight),i.setTransform(1,0,0,1,0,0)}},{key:"_fillRectLinear",value:function(t,e,i){var n=this._scaleLinearIndexToHeight(i),o=this._dimension.canvasHeight/e.length;if(0!==i&&this._colorSmoothing){var a=t.createLinearGradient(0,this._dimension.canvasHeight-n-o,0,this._dimension.canvasHeight-n);a.addColorStop(0,"rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")")),a.addColorStop(1,"rgb(".concat(e[i-1],", ").concat(e[i-1],", ").concat(e[i-1],")")),t.fillStyle=a}else t.fillStyle="rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")");t.fillRect(this._dimension.width-this._canvasSpeed,this._dimension.canvasHeight-n-o,this._canvasSpeed,o)}},{key:"_fillRectLogarithm",value:function(t,e,i){if(0!==i&&i!==e.length-1&&this._colorSmoothing){var n=t.createLinearGradient(0,this._logScale[i],0,this._logScale[i-1]);n.addColorStop(0,"rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")")),n.addColorStop(1,"rgb(".concat(e[i-1],", ").concat(e[i-1],", ").concat(e[i-1],")")),t.fillStyle=n}else t.fillStyle="rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")");t.fillRect(this._dimension.width-this._canvasSpeed,this._logScale[i-1],this._canvasSpeed,this._logScale[i]-this._logScale[i-1])}},{key:"_scaleLinearIndexToHeight",value:function(t){var e=this._fftSize/2;return t*this._dimension.canvasHeight/e}},{key:"_createLogarithmicScaleHeights",value:function(){var t=this;return new Promise((function(e){t._logScale=[t._dimension.canvasHeight];for(var i=1;i<t._fftSize/2;++i)t._logScale.push(t._computeLogSampleHeight(i));e()}))}},{key:"_computeLogSampleHeight",value:function(t){return this._dimension.canvasHeight-Math.log(t)/Math.log(10)/(Math.log(this._fftSize/2)/Math.log(10))*this._dimension.canvasHeight}}])&&et(e.prototype,i),r}(z);function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function ht(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ct(t,e,i){return(ct="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=dt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function ut(t,e){return(ut=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _t(t,e){return!e||"object"!==st(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function dt(t){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ft=32e3,pt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ut(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=dt(n);if(o){var i=dt(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return _t(this,t)});function r(t){var e,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=a.call(this,t))._colors={background:t.colors&&t.colors.background||_.defaultBackgroundColor,track:t.colors&&t.colors.track||_.defaultDarkPrimaryColor,mainBeat:t.colors&&t.colors.mainBeat||_.defaultPrimaryColor,subBeat:t.colors&&t.colors.subBeat||_.defaultAntiPrimaryColor,loop:t.colors&&t.colors.loop||_.defaultLoopColor,loopAlpha:t.colors&&t.colors.loopAlpha||_.defaultLoopAlphaColor},e._canvas.style.backgroundColor=e._colors.background,e._canvasSpeed=t.speed?t.speed:5,e._beat={offset:t.beat?t.beat.offset:null,bpm:t.beat?t.beat.bpm:null,timeSignature:t.beat?t.beat.timeSignature:null},e._wave={align:t.wave&&t.wave.align||"center",scale:t.wave&&t.wave.scale||.95},e._hotCues=function(t){if(Array.isArray(t))return lt(t)}(i=t.hotCues)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return lt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?lt(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()||[],e._beatsArray=[],e._beatCount="0.0",e._loopEntry=null,e._loopEnd=null,e._loopBuffer=null,e._isLooping=!1,e._loopStartedAt=0,e._playerPausedAt=0,e._audioBuffer=null,e._canvases=[],e._cueCanvases=[],e._beatCanvases=[],e._loopCanvases=[],e._isDragging=!1,e._wasPlaying=!1,e._draggedTime=0,e._startDrag={x:0,y:0},""!==e._player.src&&e._getPlayerSourceFile(),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){ct(dt(r.prototype),"_fillAttributes",this).call(this,t),this._offlineCtx=null,this._offlineBuffer=null,this._trackLoaded=this._trackLoaded.bind(this),this._onProgress=this._onProgress.bind(this),this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this)}},{key:"_addEvents",value:function(){ct(dt(r.prototype),"_addEvents",this).call(this),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._player.addEventListener("timeupdate",this._onProgress,!1),this._canvas.addEventListener("mousedown",this._mouseDown,!1),this._player.paused||(this._isPlaying=!0,requestAnimationFrame(this._processAudioBin))}},{key:"_removeEvents",value:function(){ct(dt(r.prototype),"_removeEvents",this).call(this),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._player.removeEventListener("timeupdate",this._onProgress,!1)}},{key:"_onResize",value:function(){ct(dt(r.prototype),"_onResize",this).call(this),this._fillData(),this._clearCanvas(),this._drawTimeline(this._player.currentTime)}},{key:"_clearCanvas",value:function(t,e,i){if(ct(dt(r.prototype),"_clearCanvas",this).call(this),t)for(var n=0;n<this._beatCanvases.length;++n)this._beatCanvases[n].getContext("2d").clearRect(0,0,this._beatCanvases[n].width,this._beatCanvases[n].height);if(e)for(var o=0;o<this._cueCanvases.length;++o)this._cueCanvases[o].getContext("2d").clearRect(0,0,this._cueCanvases[o].width,this._cueCanvases[o].height);if(i)for(var a=0;a<this._loopCanvases.length;++a)this._loopCanvases[a].getContext("2d").clearRect(0,0,this._loopCanvases[a].width,this._loopCanvases[a].height)}},{key:"_dblClick",value:function(){}},{key:"_processAudioBin",value:function(){!0!==this._isPlaying&&!0!==this._isLooping||(!0===this._isLooping&&(this._player.currentTime=this._loopEntry.time+(this._playerPausedAt+this._audioCtx.currentTime-this._loopStartedAt)%(this._loopEnd.time-this._loopEntry.time)),this._clearCanvas(),this._drawTimeline(this._player.currentTime),requestAnimationFrame(this._processAudioBin))}},{key:"_startLoopSequence",value:function(t){var e=this;t&&(this._player.currentTime=this._loopEntry.time);var i=this._audioBuffer.slice();this._audioCtx.decodeAudioData(i,(function(t){e._loopBuffer=e._audioCtx.createBufferSource(),e._loopBuffer.buffer=t,e._loopBuffer.connect(e._audioCtx.destination),e._loopBuffer.loop=!0,e._loopBuffer.loopStart=e._loopEntry.time,e._loopBuffer.loopEnd=e._loopEnd.time,e._loopBuffer.start(0,e._player.currentTime),e._player.pause(),e._loopStartedAt=e._audioCtx.currentTime,e._playerPausedAt=e._player.currentTime,e._isLooping=!0,e._processAudioBin()}))}},{key:"_trackLoaded",value:function(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}},{key:"_onProgress",value:function(){this._clearCanvas(),this._drawTimeline(this._player.currentTime||0)}},{key:"_mouseDown",value:function(t){var e=t.target.getBoundingClientRect(),i=(t.clientX-e.left-this._canvas.width/2+this._player.currentTime/this._canvasSpeed*this._canvas.width)%ft,n=t.clientY-e.top,o=this._hotCueClicked(i,n);o?(this._player.currentTime=o.time,this._clearCanvas(),this._drawTimeline(this._player.currentTime)):(this._isDragging=!0,this._startDrag.x=t.clientX,this._startDrag.y=t.clientY,!1===this._player.paused&&(this._wasPlaying=!0,this._player.pause()),this._canvas.addEventListener("mousemove",this._mouseMove,!1),this._canvas.addEventListener("mouseup",this._mouseUp,!1),this._canvas.addEventListener("mouseout",this._mouseUp,!1))}},{key:"_mouseMove",value:function(t){if(!0===this._isDragging){var e=(this._startDrag.x-t.clientX)*this._canvasSpeed/this._canvas.width*2;this._draggedTime=this._player.currentTime+e,this._clearCanvas(),this._drawTimeline(this._draggedTime)}}},{key:"_mouseUp",value:function(){this._isDragging=!1,this._startDrag.x=0,this._startDrag.y=0,this._player.currentTime=this._draggedTime||this._player.currentTime,this._draggedTime=null,!0===this._wasPlaying&&(this._wasPlaying=!1,this._player.play()),this._canvas.removeEventListener("mousemove",this._mouseMove,!1),this._canvas.removeEventListener("mouseup",this._mouseUp,!1),this._canvas.removeEventListener("mouseout",this._mouseUp,!1)}},{key:"_processAudioFile",value:function(t){var e=this;this._audioBuffer=t.slice(),this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,(function(t){e._offlineSource.buffer=t,e._offlineSource.connect(e._offlineCtx.destination),e._offlineSource.start(),e._offlineCtx.startRendering().then((function(t){e._offlineBuffer=t,e._fillData(),e._drawTimeline(e._player.currentTime||0)})).catch((function(t){console.log("Rendering failed: "+t)}))}))}},{key:"_fillData",value:function(){if(this._offlineBuffer){this._canvases=[],this._cueCanvases=[],this._beatCanvases=[],this._loopCanvases=[];for(var t=this._genScaledMonoData(this._offlineBuffer),e=this._canvasSpeed*this._offlineBuffer.sampleRate/this._canvas.width,i=Math.round(this._offlineBuffer.duration/this._canvasSpeed*this._canvas.width),n=0;n<i;n+=ft){var o=document.createElement("CANVAS"),a=o.getContext("2d"),r=document.createElement("CANVAS"),s=document.createElement("CANVAS"),l=document.createElement("CANVAS"),h=i-n;h=h>ft?ft:h,o.width=h,o.height=this._canvas.height,r.width=h,r.height=this._canvas.height,s.width=h,s.height=this._canvas.height,l.width=h,l.height=this._canvas.height,a.clearRect(0,0,i,this._canvas.height);for(var c=0;c<h;++c){for(var u=Math.floor((n+c)*e),d=0,f=0;f<e;++f)t[u+f]>d&&(d=t[u+f]);a.fillStyle=_.lightenDarkenColor(this._colors.track,190*d),d=Math.floor(d*(this._canvas.height*this._wave.scale)),"center"===this._wave.align?(a.fillRect(c,this._canvas.height/2,1,-d/2),a.fillRect(c,this._canvas.height/2,1,d/2),a.fillRect(c,this._canvas.height/2-.5,1,1)):"top"===this._wave.align?a.fillRect(c,1,1,d):"bottom"===this._wave.align&&a.fillRect(c,this._canvas.height-1,1,-d)}this._canvases.push(o),this._cueCanvases.push(r),this._beatCanvases.push(s),this._loopCanvases.push(l)}null!==this._beat.bpm&&null!==this._beat.offset&&this._fillBeatBars({totalWidth:this._offlineBuffer.duration/this._canvasSpeed*this._canvas.width,beatWidth:1/(this._beat.bpm/60)/this._canvasSpeed*this._canvas.width,beatOffset:this._beat.offset/this._canvasSpeed*this._canvas.width}),this._drawHotCues()}}},{key:"_fillBeatBars",value:function(t){for(var e=t.beatOffset,i=0,n=0;n<Math.floor(t.totalWidth/t.beatWidth);++n){if(n*t.beatWidth+e>=ft+i*ft)for(++i;1<i;++n)e+=t.beatWidth-(32e3-this._beatsArray[this._beatsArray.length-1].xPos%32e3);this._drawBeatBar(n,n*t.beatWidth+e,i)}}},{key:"_drawBeatBar",value:function(t,e,i){var n=this._beatCanvases[i],o=n.getContext("2d");t%this._beat.timeSignature==0?o.fillStyle="white":o.fillStyle="grey",o.fillRect(e%ft,9,1,this._canvas.height-18),t%this._beat.timeSignature==0?o.fillStyle=this._colors.mainBeat:o.fillStyle=this._colors.subBeat,f.drawTriangle(n,{x:e%ft,y:1,radius:6,top:10}),f.drawTriangle(n,{x:e%ft,y:this._canvas.height-1,radius:6,top:this._canvas.height-10}),this._beatsArray.push({primaryBeat:t%this._beat.timeSignature==0,beatCount:t,xPos:e,time:e*this._canvasSpeed/this._canvas.width,canvasIndex:i})}},{key:"_genScaledMonoData",value:function(t){for(var e=t.getChannelData(0),i=t.getChannelData(1),n=[],o=0;o<e.length;++o)n.push((Math.abs(e[o])+Math.abs(i[o]))/2);return n}},{key:"_drawTimeline",value:function(t){var e=Math.floor(t*this._canvas.width/this._canvasSpeed),i=Math.floor((e-this._canvas.width/2)/ft);i<0&&(i=0);var n=Math.floor((e+this._canvas.width/2)/ft);n>=this._canvases.length&&(n=this._canvases.length-1);for(var o=i;o<=n;++o)this._ctx.drawImage(this._canvases[o],this._canvas.width/2-e+ft*o,0),this._ctx.drawImage(this._beatCanvases[o],this._canvas.width/2-e+ft*o,0),this._ctx.drawImage(this._cueCanvases[o],this._canvas.width/2-e+ft*o,0),this._ctx.drawImage(this._loopCanvases[o],this._canvas.width/2-e+ft*o,0);if(this._ctx.fillStyle=_.defaultAntiPrimaryColor,this._ctx.fillRect(this._canvas.width/2,1,3,this._canvas.height-2),this._ctx.strokeStyle="black",this._ctx.lineWidth=1,this._ctx.strokeRect(this._canvas.width/2,1,3,this._canvas.height-2),this._beatsArray.length>0){for(var a="0.0",r=0;r<this._beatsArray.length;++r)if(t<=this._beatsArray[r].time){var s=Math.floor((this._beatsArray[r].beatCount-1)/this._beat.timeSignature)+1,l=(this._beatsArray[r].beatCount-1)%this._beat.timeSignature;a="".concat(s,".").concat(-1===l?1:l+1);break}var h=14;"top"===this._wave.align&&(h=this._canvas.height-4),f.drawBeatCount(this._canvas,{label:a,x:this._canvas.width/2+8,y:h})}}},{key:"_drawHotCues",value:function(){for(var t=0;t<this._hotCues.length;++t)this._drawHotCue(this._hotCues[t])}},{key:"_drawHotCue",value:function(t){var e=2;"top"===this._wave.align&&(e=this._canvas.height-20),f.drawHotCue(this._cueCanvases[t.canvasIndex],{x:t.xPos-t.canvasIndex*ft+9,y:e,size:18,label:t.label||t.number,color:t.color})}},{key:"_hotCueClicked",value:function(t,e){if(e>2&&e<20)for(var i=0;i<this._hotCues.length;++i){var n=this._hotCues[i].xPos-this._hotCues[i].canvasIndex*ft;if(t>n&&t<n+18)return this._hotCues[i]}return!1}},{key:"_drawLoop",value:function(){if(this._loopEntry&&(this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d").fillStyle=this._colors.loop,f.drawTriangle(this._loopCanvases[this._loopEntry.canvasIndex],{x:this._loopEntry.xPos%ft+1,y:1,radius:9,top:14}),f.drawTriangle(this._loopCanvases[this._loopEntry.canvasIndex],{x:this._loopEntry.xPos%ft+1,y:this._loopCanvases[this._loopEntry.canvasIndex].height-1,radius:9,top:this._loopCanvases[this._loopEntry.canvasIndex].height-14})),this._loopEnd&&(this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d").fillStyle=this._colors.loop,f.drawTriangle(this._loopCanvases[this._loopEnd.canvasIndex],{x:this._loopEnd.xPos%ft+1,y:1,radius:9,top:14}),f.drawTriangle(this._loopCanvases[this._loopEnd.canvasIndex],{x:this._loopEnd.xPos%ft+1,y:this._loopCanvases[this._loopEnd.canvasIndex].height-1,radius:9,top:this._loopCanvases[this._loopEnd.canvasIndex].height-14})),this._loopEntry&&this._loopEnd){var t=this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d");t.fillStyle=this._colors.loopAlpha,this._loopEntry.canvasIndex===this._loopEnd.canvasIndex&&t.fillRect(this._loopEntry.xPos,30,this._loopEnd.xPos-this._loopEntry.xPos,this._loopCanvases[this._loopEntry.canvasIndex].height-60)}}},{key:"_getPlayerSourceFile",value:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this._player.src,!0),e.responseType="arraybuffer",e.onload=function(){t._processAudioFile(e.response)},e.send()}},{key:"updateBeatInfo",value:function(t){this._beat={offset:t.offset,bpm:t.bpm,timeSignature:t.timeSignature}}},{key:"setHotCuePoint",value:function(t){for(var e=this.getClosestBeat(),i=null,n=0;n<this._hotCues.length;++n)if(this._hotCues[n].beatCount===e.beatCount){i=this._hotCues[n];break}return i||(e.number=this._hotCues.length+1,e.time=e.xPos*this._canvasSpeed/this._canvas.width,e.label=this._hotCues.length+1,t.label&&(e.label=t.label),t.color&&(e.color=t.color),this._hotCues.push(e),this._clearCanvas(),this._drawHotCue(e),this._drawTimeline(this._player.currentTime),e)}},{key:"updateHotCuePoint",value:function(t,e){for(var i=0;i<this._hotCues.length;++i)this._hotCues[i].beatCount===t.beatCount&&(e.label&&(this._hotCues[i].label=e.label),e.color&&(this._hotCues[i].color=e.color));this._clearCanvas(!1,!0),this._drawHotCues(),this._drawTimeline(this._player.currentTime)}},{key:"removeHotCuePoint",value:function(t){for(var e=0;e<this._hotCues.length;++e)if(this._hotCues[e].beatCount===t.beatCount){this._hotCues.splice(e,1),this._clearCanvas(!1,!0),this._drawHotCues(),this._drawTimeline(this._player.currentTime);break}}},{key:"setLoopEntryPoint",value:function(){this._loopEntry=this.getClosestBeat(),this._clearCanvas(!1,!1,!0),this._drawLoop(),this._drawTimeline(this._player.currentTime)}},{key:"setLoopEndPoint",value:function(t){if(this._loopEntry){if(t)this._loopEntry.beatCount+t<this._beatsArray.length?this._loopEnd=this._beatsArray[this._loopEntry.beatCount+t]:this._loopEnd=this._beatsArray[this._beatsArray.length-1];else{var e=this.getClosestBeat();e!==this._loopEntry&&this._loopEntry.time<e.time&&(this._loopEnd=e)}this._clearCanvas(!1,!1,!0),this._drawLoop(),this._drawTimeline(this._player.currentTime)}}},{key:"exitLoop",value:function(){this._loopEntry=null,this._loopEnd=null,this._loopBuffer=null,this._isLooping=!1,this._loopStartedAt=0,this._playerPausedAt=0,this._clearCanvas(!1,!1,!0),this._drawTimeline(this._player.currentTime)}},{key:"getClosestBeat",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Math.floor(this._player.currentTime*this._canvas.width/this._canvasSpeed),i={},n=0;n<this._beatsArray.length;++n)if(this._beatsArray[n].xPos>e){if(n-1>0&&this._beatsArray[n].xPos-e>e-this._beatsArray[n-1].xPos){i=this._beatsArray[n-1];break}i=this._beatsArray[n];break}return t?i.time:i}}])&&ht(e.prototype,i),r}(c);function yt(t){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vt(t){return function(t){if(Array.isArray(t))return gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return gt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?gt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function mt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function bt(t,e,i){return(bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=kt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(i):o.value}})(t,e,i||t)}function Ct(t,e){return(Ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function wt(t,e){return!e||"object"!==yt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function kt(t){return(kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ct(t,e)}(r,t);var e,i,n,o,a=(n=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=kt(n);if(o){var i=kt(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return wt(this,t)});function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=a.call(this,t))._colors={background:t.colors&&t.colors.background||_.defaultBackgroundColor,track:t.colors&&t.colors.track||_.defaultTextColor,progress:t.colors&&t.colors.progress||_.defaultPrimaryColor},e._canvas.style.backgroundColor=e._colors.background,""!==e._player.src&&e._getPlayerSourceFile(),e}return e=r,(i=[{key:"_fillAttributes",value:function(t){bt(kt(r.prototype),"_fillAttributes",this).call(this,t),this._animation=t.animation,this._wave={align:t.wave&&t.wave.align||"center",barWidth:t.wave&&t.wave.barWidth||1,barMarginScale:t.wave?t.wave.barMarginScale/2:.125,merged:t.wave&&t.wave.merged||!0,noSignalLine:!!t.wave&&(t.wave.noSignalLine||!0)},this._hotCues=t.hotCues||[],this._bars=null,this._offlineCtx=null,this._offlineBuffer=null,this._dataL=[],this._dataR=[],this._trackLoaded=this._trackLoaded.bind(this),this._onProgress=this._onProgress.bind(this),this._onClick=this._onClick.bind(this)}},{key:"_buildUI",value:function(){bt(kt(r.prototype),"_buildUI",this).call(this),this._bars=this._canvas.width/this._wave.barWidth}},{key:"_addEvents",value:function(){bt(kt(r.prototype),"_addEvents",this).call(this),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._player.addEventListener("seeking",this._onProgress,!1),this._dom.container.addEventListener("click",this._onClick,!1)}},{key:"_removeEvents",value:function(){bt(kt(r.prototype),"_removeEvents",this).call(this),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._player.removeEventListener("seeking",this._onProgress,!1),this._dom.container.removeEventListener("click",this._onClick,!1)}},{key:"_onResize",value:function(){bt(kt(r.prototype),"_onResize",this).call(this),this._bars=this._canvas.width/this._wave.barWidth,this._fillData(),this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_onProgress",value:function(){this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_dblClick",value:function(){}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration),requestAnimationFrame(this._processAudioBin))}},{key:"_trackLoaded",value:function(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}},{key:"_onClick",value:function(t){var e=t.target.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,o=this._hotCueClicked(i,n);if(o)this._player.currentTime=o.time;else{var a=t.target.getBoundingClientRect(),r=t.clientX-a.left;this._player.currentTime=r/this._canvas.width*this._player.duration}this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_processAudioFile",value:function(t){var e=this;this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,(function(t){e._offlineSource.buffer=t,e._offlineSource.connect(e._offlineCtx.destination),e._offlineSource.start(),e._offlineCtx.startRendering().then((function(t){e._offlineBuffer=t,e._fillData(),e._drawFileWaveform(e._player.currentTime/e._player.duration)})).catch((function(t){console.log("Rendering failed: "+t)}))}))}},{key:"_fillData",value:function(){this._offlineBuffer&&(!0===this._wave.merged?this._dataL=this._genScaledMonoData(this._offlineBuffer):(this._dataL=this._genScaledData(this._offlineBuffer.getChannelData(0)),this._dataR=this._genScaledData(this._offlineBuffer.getChannelData(1))))}},{key:"_genScaledData",value:function(t){for(var e=Math.floor(t.length/this._bars),i=[],n=0;n<=t.length-e;n+=e){for(var o=0,a=0;a<e;++a)o+=Math.abs(t[n+a]);i.push(o/e)}return this._scaleDataToHeight(i)}},{key:"_genScaledMonoData",value:function(t){for(var e=t.getChannelData(0),i=t.getChannelData(1),n=Math.floor(e.length/this._bars),o=[],a=0;a<=e.length-n;a+=n){for(var r=0,s=0;s<n;++s)r+=(Math.abs(e[a+s])+Math.abs(i[a+s]))/2;o.push(r/n)}return this._scaleDataToHeight(o)}},{key:"_scaleDataToHeight",value:function(t){for(var e=Math.max.apply(Math,vt(t)),i=Math.min.apply(Math,vt(t)),n=e-i,o=.9*this._canvas.height,a=[],r=0;r<t.length;++r)a.push((t[r]-i)*o/n);return a}},{key:"_drawFileWaveform",value:function(t){var e=this._canvas.width/this._bars,i=e*this._wave.barMarginScale;this._ctx.beginPath();for(var n=0;n<this._dataL.length;++n){var o=this._dataL[n]/2,a=!0===this._wave.merged?this._dataL[n]/2:this._dataR[n]/2;if(this._ctx.fillStyle=this._colors.track,e*(n+1)/this._canvas.width>t&&e*n/this._canvas.width<t){var r=this._ctx.createLinearGradient(e*n+i,0,e*(n+1)-i,0),s=e*(n+1)-e*n,l=t*this._canvas.width,h=Math.abs(l-e*n)/s;if("gradient"===this._animation)h+.01<1?(r.addColorStop(0,this._colors.progress),r.addColorStop(h,this._colors.progress),r.addColorStop(h+.01,this._colors.track),r.addColorStop(1,this._colors.track),this._ctx.fillStyle=r):this._ctx.fillStyle=this._colors.progress;else{var c=Math.round(255*h);this._ctx.fillStyle=_.lightenDarkenColor(this._colors.progress,255-c)}}else n/this._dataL.length<t&&(this._ctx.fillStyle=this._colors.progress);"center"===this._wave.align?(this._ctx.fillRect(e*n+i,this._canvas.height/2-o,e-2*i,o),this._ctx.fillRect(e*n+i,this._canvas.height/2,e-2*i,a),this._wave.noSignalLine&&this._ctx.fillRect(e*n+i,this._canvas.height/2-.5,e-2*i,1)):"bottom"===this._wave.align?(this._ctx.fillRect(e*n+i,this._canvas.height-o,e-2*i,o),this._ctx.fillRect(e*n+i,this._canvas.height-o-a+1,e-2*i,a)):"top"===this._wave.align&&(this._ctx.fillRect(e*n+i,0,e-2*i,o),this._ctx.fillRect(e*n+i,o-1,e-2*i,a))}this._ctx.closePath(),this._drawHotCues()}},{key:"_drawHotCues",value:function(){for(var t=0;t<this._hotCues.length;++t)this._drawHotCue(this._hotCues[t])}},{key:"_drawHotCue",value:function(t){f.drawHotCue(this._canvas,{x:t.time*this._canvas.width/this._player.duration+9,y:2,size:18,label:t.label||t.number,color:t.color})}},{key:"_hotCueClicked",value:function(t,e){if(e>2&&e<20)for(var i=0;i<this._hotCues.length;++i){var n=this._hotCues[i].time*this._canvas.width/this._player.duration;if(t>n&&t<n+18)return this._hotCues[i]}return!1}},{key:"_getPlayerSourceFile",value:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this._player.src,!0),e.responseType="arraybuffer",e.onload=function(){t._processAudioFile(e.response)},e.send()}},{key:"setHotCuePoint",value:function(t){for(var e=null,i=0;i<this._hotCues.length;++i)if(this._hotCues[i].beatCount===t.beatCount){e=this._hotCues[i];break}e||(this._hotCues.push(t),this._drawHotCues())}},{key:"updateHotCuePoint",value:function(t,e){for(var i=0;i<this._hotCues.length;++i)this._hotCues[i].beatCount===t.beatCount&&(e.label&&(this._hotCues[i].label=e.label),e.color&&(this._hotCues[i].color=e.color));this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"removeHotCuePoint",value:function(t){for(var e=0;e<this._hotCues.length;++e)if(this._hotCues[e].beatCount===t.beatCount){this._hotCues.splice(e,1),this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration);break}}}])&&mt(e.prototype,i),r}(c);function St(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}window.AudioContext=window.AudioContext||window.webkitAudioContext;var Rt=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"bars"===e.type?new b(e):"circle"===e.type?new O(e):"oscilloscope"===e.type?new X(e):"peakmeter"===e.type?new Q(e):"spectrum"===e.type?new rt(e):"timeline"===e.type?new pt(e):"waveform"===e.type?new xt(e):null}var e,i;return e=t,i=[{key:"version",get:function(){return"0.9.8"}}],null&&St(e.prototype,null),i&&St(e,i),t}();window.AudioVisualizer=Rt;var Pt=Rt}},e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}return i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i(608)}().default;