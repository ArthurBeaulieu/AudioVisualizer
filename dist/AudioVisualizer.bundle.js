!function(){"use strict";var t={d:function(e,i){for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},e={};function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.d(e,{default:function(){return Dt}});var n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._type=null,this._player=null,this._renderTo=null,this._fftSize=null,this._audioCtx=null,this._inputNode=null,this._isPlaying=!1,this._dom={container:null},this._parentDimension={position:null,height:null,width:null,zIndex:null},this._resizeObserver=null,this._onResize=this._onResize.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._dblClick=this._dblClick.bind(this),this._processAudioBin=this._processAudioBin.bind(this)}var e,n;return e=t,(n=[{key:"destroy",value:function(){var t=this;this._removeEvents(),Object.keys(this).forEach((function(e){delete t[e]}))}},{key:"_fillAttributes",value:function(){}},{key:"_buildUI",value:function(){}},{key:"_setAudioNodes",value:function(){}},{key:"_processAudioBin",value:function(){}},{key:"_addEvents",value:function(){this._resizeObserver=new ResizeObserver(this._onResize),this._resizeObserver.observe(this._renderTo),this._player.addEventListener("play",this._play,!1),this._player.addEventListener("pause",this._pause,!1),this._dom.container.addEventListener("dblclick",this._dblClick,!1)}},{key:"_removeEvents",value:function(){this._resizeObserver.disconnect(),this._player.removeEventListener("play",this._play,!1),this._player.removeEventListener("pause",this._pause,!1),this._dom.container.removeEventListener("dblclick",this._dblClick,!1)}},{key:"_play",value:function(){this._audioCtx.resume(),this._isPlaying=!0,this._processAudioBin()}},{key:"_pause",value:function(){this._audioCtx.suspend(),this._isPlaying=!1}},{key:"_onResize",value:function(){}},{key:"_dblClick",value:function(){var t=this;document.fullscreenElement?document.exitFullscreen().then((function(){t._renderTo.style.position=t._parentDimension.position,t._renderTo.style.height=t._parentDimension.height,t._renderTo.style.width=t._parentDimension.width,t._renderTo.style.zIndex=t._parentDimension.zIndex,t._parentDimension={position:null,height:null,width:null,zIndex:null}})):document.documentElement.requestFullscreen().then((function(){t._parentDimension={position:t._renderTo.style.position,height:t._renderTo.style.height,width:t._renderTo.style.width,zIndex:t._renderTo.style.zIndex||""},t._renderTo.style.position="fixed",t._renderTo.style.height="100vh",t._renderTo.style.width="100vw",t._renderTo.style.zIndex="999"}))}},{key:"_clearCanvas",value:function(){}}])&&i(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function s(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var c=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(h,t);var e,i,n,o,c=(n=h,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=l(n);if(o){var i=l(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return s(this,t)});function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=c.call(this))._nodes={source:null,analyser:null},e._canvas=null,e._ctx=null,e._fillAttributes(t),e._buildUI(),e._setAudioNodes(),e._addEvents(),e}return e=h,(i=[{key:"_fillAttributes",value:function(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize,this._audioCtx=t.audioContext,this._inputNode=t.inputNode}},{key:"_buildUI",value:function(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-".concat(this._type)),this._canvas=document.createElement("CANVAS"),this._canvas.style.cssText="background-color:black;border:solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctx=this._canvas.getContext("2d"),this._ctx.translate(.5,.5),this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2,this._dom.container.appendChild(this._canvas),this._renderTo.appendChild(this._dom.container)}},{key:"_setAudioNodes",value:function(){var t=!1;this._audioCtx?(t=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player)),this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),t||this._nodes.analyser.connect(this._audioCtx.destination)}},{key:"_onResize",value:function(){this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2}},{key:"_clearCanvas",value:function(){this._canvas.getContext("2d").clearRect(0,0,this._canvas.width,this._canvas.height)}}])&&r(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),h}(n);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var d=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"drawRadialGradient",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.drawRadialGradient : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==h(e))return new Error("ColorUtils.drawRadialGradient : Invalid type for canvas or options");if(!e.colors||!Array.isArray(e.colors))return new Error("ColorUtils.drawRadialGradient : Options object is not properly formed");for(var i=0;i<e.colors.length;++i){if(void 0===e.colors[i].index||null===e.colors[i].index||"number"!=typeof e.colors[i].index||void 0===e.colors[i].color||null===e.colors[i].color||"string"!=typeof e.colors[i].color)return new Error("ColorUtils.drawRadialGradient : Invalid type for a color sent in options object");if(e.colors[i].index<0||e.colors[i].index>1)return new Error("ColorUtils.drawRadialGradient : An index sent in options object is not a valid float in [0, 1]")}if(void 0===e.x0||null===e.x0||void 0===e.y0||null===e.y0||void 0===e.r0||null===e.r0)return new Error("ColorUtils.drawRadialGradient : Missing arguments options.x0 or options.y0 or options.r0");if("number"!=typeof e.x0||"number"!=typeof e.y0||"number"!=typeof e.r0)return new Error("ColorUtils.drawRadialGradient : Invalid type for options.x0 or options.y0 or options.r0");if(void 0===e.x1||null===e.x1||void 0===e.y1||null===e.y1||void 0===e.r1||null===e.r1)return new Error("ColorUtils.drawRadialGradient : Missing arguments options.x1 or options.y1 or options.r1");if("number"!=typeof e.x1||"number"!=typeof e.y1||"number"!=typeof e.r1)return new Error("ColorUtils.drawRadialGradient : Invalid type for options.x1 or options.y1 or options.r1");for(var n=t.getContext("2d"),o=n.createRadialGradient(e.x0,e.y0,e.r0,e.x1,e.y1,e.r1),r=0;r<e.colors.length;++r)o.addColorStop(e.colors[r].index,e.colors[r].color);n.fillStyle=o,n.fillRect(0,0,t.width,t.height)}},{key:"radialGlowGradient",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.radialGlowGradient : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==h(e))return new Error("ColorUtils.radialGlowGradient : Invalid type for canvas or options");if(!e.colors||!Array.isArray(e.colors))return new Error("ColorUtils.radialGlowGradient : Options object is not properly formed");for(var i=0;i<e.colors.length;++i){if(void 0===e.colors[i].index||null===e.colors[i].index||"number"!=typeof e.colors[i].index||void 0===e.colors[i].color||null===e.colors[i].color||"string"!=typeof e.colors[i].color)return new Error("ColorUtils.radialGlowGradient : Invalid type for a color sent in options object");if(e.colors[i].index<0||e.colors[i].index>1)return new Error("ColorUtils.radialGlowGradient : An index sent in options object is not a valid float in [0, 1]")}if(void 0===e.centerX||null===e.centerX||void 0===e.centerY||null===e.centerY||void 0===e.radius||null===e.radius)return new Error("ColorUtils.radialGlowGradient : Missing arguments options.centerX or options.centerY or options.radius");if("number"!=typeof e.centerX||"number"!=typeof e.centerY||"number"!=typeof e.radius)return new Error("ColorUtils.radialGlowGradient : Invalid type for options.centerX or options.centerY or options.radius");for(var n=t.getContext("2d").createRadialGradient(e.centerX,e.centerY,0,e.centerX,e.centerY,e.radius),o=0;o<e.colors.length;++o)n.addColorStop(e.colors[o].index,e.colors[o].color);return n}},{key:"linearGradient",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.linearGradient : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==h(e))return new Error("ColorUtils.linearGradient : Invalid type for canvas or options");if(!e.colors||!Array.isArray(e.colors))return new Error("ColorUtils.linearGradient : Options object is not properly formed");for(var i=0;i<e.colors.length;++i){if(void 0===e.colors[i].index||null===e.colors[i].index||"number"!=typeof e.colors[i].index||void 0===e.colors[i].color||null===e.colors[i].color||"string"!=typeof e.colors[i].color)return new Error("ColorUtils.linearGradient : Invalid type for a color sent in options object");if(e.colors[i].index<0||e.colors[i].index>1)return new Error("ColorUtils.linearGradient : An index sent in options object is not a valid float in [0, 1]")}var n=t.getContext("2d"),o=n.createLinearGradient(0,0,t.width,0);!0===e.vertical&&(o=n.createLinearGradient(0,t.height,0,0));for(var r=0;r<e.colors.length;++r)o.addColorStop(e.colors[r].index,e.colors[r].color);return o}},{key:"rainbowLinearGradient",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null==e?new Error("ColorUtils.rainbowLinearGradient : Missing arguments canvas"):"CANVAS"!==e.nodeName||"boolean"!=typeof i?new Error("ColorUtils.rainbowLinearGradient : Invalid type for canvas or vertical"):t.linearGradient(e,{vertical:i,colors:[{color:"red",index:0},{color:"orange",index:1/7},{color:"yellow",index:2/7},{color:"green",index:3/7},{color:"blue",index:4/7},{color:"indigo",index:5/7},{color:"violet",index:6/7},{color:"red",index:1}]})}},{key:"lightenDarkenColor",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.lightenDarkenColor : Missing arguments color or amount");if("string"!=typeof t||"number"!=typeof e)return new Error("ColorUtils.lightenDarkenColor : Invalid type for color or amount");var i=!1;if("#"===t[0]&&(t=t.slice(1),i=!0),!/^[a-fA-F0-9]+$/i.test(t))return new Error("ColorUtils.lightenDarkenColor : Color is not a valid hexadecimal value");if(e<-100||e>100)return new Error("ColorUtils.lightenDarkenColor : Amount is not a valid float in [-100, 100]");if(0===e)return(i?"#":"")+t.toLowerCase();e>0?e+=16:e-=16;var n=parseInt(t,16),o=(n>>16)+e;o>255?o=255:o<0&&(o=0);var r=(n>>8&255)+e;r>255?r=255:r<0&&(r=0);var a=(255&n)+e;return a>255?a=255:a<0&&(a=0),(i?"#":"")+(a|r<<8|o<<16).toString(16)}},{key:"alphaColor",value:function(t,e){if(null==t||null==e)return new Error("ColorUtils.alphaColor : Missing arguments color or alpha");if("string"!=typeof t||"number"!=typeof e)return new Error("ColorUtils.alphaColor : Invalid type for color or alpha");if("#"===t[0]&&(t=t.slice(1)),!/^[a-fA-F0-9]+$/i.test(t))return new Error("ColorUtils.alphaColor : Color is not a valid hexadecimal value");if(e<0||e>1)return new Error("ColorUtils.alphaColor : Alpha is not a valid float in [0, 1]");var i=parseInt(t,16);return"rgba(".concat(i>>16,", ").concat(i>>8&255,", ").concat(255&i,", ").concat(e,")")}},{key:"defaultBackgroundColor",get:function(){return"#1D1E25"}},{key:"defaultTextColor",get:function(){return"#E7E9E7"}},{key:"defaultPrimaryColor",get:function(){return"#56D45B"}},{key:"defaultAntiPrimaryColor",get:function(){return"#FF6B67"}},{key:"defaultDarkPrimaryColor",get:function(){return"#12B31D"}},{key:"defaultLoopColor",get:function(){return"#FFAD67"}},{key:"defaultLoopAlphaColor",get:function(){return this.alphaColor("FFAD67",.5)}},{key:"defaultAudioGradient",get:function(){return[{color:"#56D45B",index:0},{color:"#AFF2B3",index:.7},{color:"#FFAD67",index:.833},{color:"#FF6B67",index:.9},{color:"#FFBAB8",index:1}]}}],null&&u(e.prototype,null),i&&u(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),f=d;function _(t){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_(t)}function p(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,i;return e=t,i=[{key:"drawRadialBar",value:function(t,e){var i=t.getContext("2d"),n=e.frequencyValue/255;i.beginPath(),i.moveTo(e.x0,e.y0),i.lineTo(e.x1,e.y1),i.strokeStyle=f.lightenDarkenColor(e.color,100*n),i.lineWidth=e.width,i.stroke(),i.closePath()}},{key:"drawCircle",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.lineWidth=e.width,i.strokeStyle=e.color,i.stroke(),i.closePath()}},{key:"drawCircleGlow",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.fillStyle=f.radialGlowGradient(t,e),i.fill(),i.closePath()}},{key:"drawDisc",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.fillStyle=e.color,i.fill(),i.closePath()}},{key:"drawVerticalBar",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.fillRect(e.originX,t.height-e.height,e.width,e.height),e.vertical=!0,i.fillStyle=f.linearGradient(t,e),i.fillRect(e.originX,t.height-e.height,e.width,e.height),i.closePath()}},{key:"drawOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath();for(var n=0,o=t.width/e.samples,r=0;r<e.samples;++r){var a=e.timeDomain[r]/255,s=t.height*a;r>0?i.lineTo(n,s):i.moveTo(n,s),n+=o}"rainbow"===e.colors?i.strokeStyle=f.rainbowLinearGradient(t):Array.isArray(e.colors)?i.strokeStyle=f.linearGradient(t,e):i.strokeStyle=e.colors,i.stroke(),i.closePath()}},{key:"drawPointsOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath();for(var n=0;n<e.length;++n){var o=t.height*(e.times[n]/255),r=t.height-o-1,a=t.width/e.length;i.fillStyle=e.color,i.fillRect(n*a,r,2,2)}i.stroke(),i.fill(),i.closePath()}},{key:"drawRadialOscilloscope",value:function(t,e){var i=t.getContext("2d");i.beginPath(),i.save(),i.translate(e.centerX,e.centerY),i.rotate(e.rotation),i.translate(-e.centerX,-e.centerY),i.moveTo(e.points[0].dx,e.points[0].dy),i.strokeStyle=e.color;for(var n=0;n<e.length-1;++n){var o=e.points[n];o.dx=o.x+e.times[n]*Math.sin(Math.PI/180*o.angle),o.dy=o.y+e.times[n]*Math.cos(Math.PI/180*o.angle);var r=(o.dx+e.points[n+1].dx)/2,a=(o.dy+e.points[n+1].dy)/2;i.quadraticCurveTo(o.dx,o.dy,r,a)}var s=e.times[e.length-1],l=e.points[e.length-1];l.dx=l.x+s*Math.sin(Math.PI/180*l.angle),l.dy=l.y+s*Math.cos(Math.PI/180*l.angle);var c=(l.dx+e.points[0].dx)/2,h=(l.dy+e.points[0].dy)/2;i.quadraticCurveTo(l.dx,l.dy,c,h),i.quadraticCurveTo(c,h,e.points[0].dx,e.points[0].dy),i.lineWidth=1,i.lineCap="round",i.stroke(),i.restore(),i.closePath()}},{key:"drawPeakMeter",value:function(t,e){if(null==t||null==e)return new Error("CanvasUtils.drawPeakMeter : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==_(e))return new Error("CanvasUtils.drawPeakMeter : Invalid type for canvas or options");if(void 0===e.orientation||null===e.orientation||void 0===e.amplitude||null===e.amplitude||void 0===e.peak||null===e.peak||void 0===e.colors||null===e.colors)return new Error("CanvasUtils.drawPeakMeter : Missing arguments options.orientation or options.amplitude or options.peak or options.top");var i=t.getContext("2d");if(e.vertical="vertical"===e.orientation,i.fillStyle=f.linearGradient(t,e),i.fill(),"horizontal"===e.orientation){var n=t.width-e.amplitude;i.fillRect(0,0,n,t.height)}else if("vertical"===e.orientation){var o=t.height-e.amplitude;i.fillRect(0,t.height-o,t.width,o)}if(i.fillStyle="#FF6B67","horizontal"===e.orientation){var r=t.width-e.peak;i.fillRect(r,0,1,t.height)}else if("vertical"===e.orientation){var a=t.height-e.peak;i.fillRect(0,t.height-a,t.width,1)}}},{key:"drawTriangle",value:function(t,e){if(null==t||null==e)return new Error("CanvasUtils.drawTriangle : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==_(e))return new Error("CanvasUtils.drawTriangle : Invalid type for canvas or options");if(void 0===e.x||null===e.x||void 0===e.y||null===e.y||void 0===e.radius||null===e.radius||void 0===e.top||null===e.top)return new Error("CanvasUtils.drawTriangle : Missing arguments options.x or options.y or options.radius or options.top");if("number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.radius||"number"!=typeof e.top)return new Error("CanvasUtils.drawTriangle : Invalid type for options.x or options.y or options.radius or options.top");var i=t.getContext("2d");i.beginPath(),i.moveTo(e.x-e.radius,e.y),i.lineTo(e.x+e.radius,e.y),i.lineTo(e.x,e.top),i.fill(),i.closePath()}},{key:"drawHotCue",value:function(t,e){if(null==t||null==e)return new Error("CanvasUtils.drawHotCue : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==_(e))return new Error("CanvasUtils.drawHotCue : Invalid type for canvas or options");if(void 0===e.x||null===e.x||void 0===e.y||null===e.y||void 0===e.size||null===e.size||void 0===e.label||null===e.label)return new Error("CanvasUtils.drawHotCue : Missing arguments options.x or options.y or options.size or options.label");if("number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.size||"string"!=typeof e.label)return new Error("CanvasUtils.drawHotCue : Invalid type for options.x or options.y or options.size or options.label");var i=t.getContext("2d");i.beginPath(),i.fillStyle=f.defaultBackgroundColor,i.fillRect(e.x-e.size/2-1,e.y-1,e.size+2,e.size+2),i.fillStyle=e.color||f.defaultPrimaryColor,i.fillRect(e.x-e.size/2,e.y,e.size,e.size),i.fillStyle=f.defaultBackgroundColor,i.font="bold 8pt sans-serif",i.textAlign="center",i.fillText(e.label||"",e.x,e.y+3*e.size/4),i.closePath()}},{key:"drawBeatCount",value:function(t,e){if(null==t||null==e)return new Error("CanvasUtils.drawBeatCount : Missing arguments canvas or options");if("CANVAS"!==t.nodeName||"object"!==_(e))return new Error("CanvasUtils.drawBeatCount : Invalid type for canvas or options");if(void 0===e.x||null===e.x||void 0===e.y||null===e.y||void 0===e.label||null===e.label)return new Error("CanvasUtils.drawBeatCount : Missing arguments options.x or options.y or options.label");if("number"!=typeof e.x||"number"!=typeof e.y||"string"!=typeof e.label)return new Error("CanvasUtils.drawBeatCount : Invalid type for options.x or options.y or options.label");var i=t.getContext("2d");i.beginPath(),i.fillStyle=f.defaultPrimaryColor,i.font="bold 10pt sans-serif",i.textAlign="left",i.fillText("".concat(e.label," Bars"),e.x,e.y),i.closePath()}},{key:"precisionRound",value:function(t,e){if(null==t||null==e)return new Error("CanvasUtils.precisionRound : Missing arguments value or precision");if("number"!=typeof t||"number"!=typeof e)return new Error("CanvasUtils.precisionRound : Invalid type for value or precision");var i=Math.pow(10,e||0);return Math.round(t*i)/i}}],null&&p(e.prototype,null),i&&p(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function g(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function m(t,e){return m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},m(t,e)}function b(t,e){if(e&&("object"===v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}var C=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=w(n);if(o){var i=w(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return b(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=r.call(this,t),t.colors&&t.colors.gradient?e._barGradient=t.colors.gradient:e._barGradient=f.defaultAudioGradient,e._canvas.style.backgroundColor=t.colors&&t.colors.background||f.defaultBackgroundColor,e}return e=a,(i=[{key:"_processAudioBin",value:function(){if(!0===this._isPlaying){this._clearCanvas();var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t);for(var e=this._canvas.width/this._nodes.analyser.frequencyBinCount,i=0,n=0;n<this._nodes.analyser.frequencyBinCount;++n){var o=t[n]/255*this._canvas.height;y.drawVerticalBar(this._canvas,{height:o,width:e,colors:this._barGradient,originX:i}),i+=e}requestAnimationFrame(this._processAudioBin)}}}])&&g(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(c);function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function R(t,e,i){return e&&S(t.prototype,e),i&&S(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function P(){return P="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=E(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},P.apply(this,arguments)}function E(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=L(t)););return t}function A(t,e){return A=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},A(t,e)}function T(t,e){if(e&&("object"===x(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function L(t){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},L(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e)}(o,t);var e,i,n=(e=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=L(e);if(i){var o=L(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return T(this,t)});function o(t){return k(this,o),n.call(this,t)}return R(o,[{key:"_fillAttributes",value:function(t){P(L(o.prototype),"_fillAttributes",this).call(this,t),this._imageSrc=null,this._centerX=null,this._centerY=null,this._radius=null,this._radialSection=null,this._barCount=null,this._barMaxHeight=null,this._circleStrokeWidth=null,this._stars=[],this._points=[],this._oscilloscopeRotation=null,this._dom.logo=null,this._averageBreakpoint=132,this._averageHit=!1,this._imageSrc=t.image,this._dom.logo=document.createElement("IMG"),this._dom.logo.classList.add("paused"),this._dom.logo.src=this._imageSrc}},{key:"_buildUI",value:function(){P(L(o.prototype),"_buildUI",this).call(this),this._imageSrc&&this._dom.container.appendChild(this._dom.logo),this._buildBackgroundBase()}},{key:"_play",value:function(){P(L(o.prototype),"_play",this).call(this),this._dom.logo.classList.remove("paused")}},{key:"_pause",value:function(){P(L(o.prototype),"_pause",this).call(this),this._dom.logo.classList.add("paused")}},{key:"_onResize",value:function(){P(L(o.prototype),"_onResize",this).call(this),this._circleStrokeWidth=2,this._barCount=this._nodes.analyser.frequencyBinCount,this._centerX=this._canvas.width/2,this._centerY=this._canvas.height/2,this._barMaxHeight=this._canvas.height/8,this._radius=this._canvas.height/4-this._canvas.height/16,this._radialSection=2*Math.PI/this._barCount,this._stars=[];for(var t=0;t<1500;++t)this._stars.push(new B(this._centerX,this._centerY,null,this._averageBreakpoint));this._points=[];for(var e=0;e<this._fftSize/2;++e)this._points.push(new j({index:e,height:this._canvas.height,width:this._canvas.width,total:this._fftSize/2}));this._buildBackgroundBase()}},{key:"_processAudioBin",value:function(){if(!0===this._isPlaying){this._clearCanvas(),this._buildBackgroundBase();var t=new Uint8Array(this._nodes.analyser.frequencyBinCount),e=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._nodes.analyser.getByteTimeDomainData(e);var i=this._getAverageFrequency(t);this._averageHit=i>this._averageBreakpoint,this._animateCircleBars(t),this._animateStars(i),this._animateCircleGlow(i),this._animateOscilloscopes(e),requestAnimationFrame(this._processAudioBin)}}},{key:"_buildBackgroundBase",value:function(){f.drawRadialGradient(this._canvas,{x0:this._centerX,y0:this._centerY,r0:this._radius,x1:this._centerX,y1:this._centerY,r1:this._canvas.width/2.66,colors:[{color:"#3C405D",index:0},{color:"#060609",index:1}]}),y.drawCircle(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:this._radius,radStart:0,radEnd:2*Math.PI,width:2*this._circleStrokeWidth})}},{key:"_animateCircleBars",value:function(t){for(var e=Math.round(this._radialSection*this._radius),i=0;i<t.length;++i){var n=t[i]/255*this._barMaxHeight;y.drawRadialBar(this._canvas,{frequencyValue:t[i],x0:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),y0:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),x1:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+n),y1:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+n),width:e,color:this._averageHit?"#56D45B":"#37C340"})}}},{key:"_animateStars",value:function(t){for(var e=this._averageHit?t/20:t/60,i=0;i<this._stars.length;++i){var n=this._stars[i];n.updatePosition(e,.6),(n.x<-this._centerX||n.x>this._centerX||n.y<-this._centerY||n.y>this._centerY)&&(n=new B(this._centerX,this._centerY,t,this._averageBreakpoint),this._stars[i]=n),y.drawDisc(this._canvas,{centerX:n.x+this._centerX,centerY:n.y+this._centerY,radius:n.radius,radStart:2*Math.PI,radEnd:!1,color:n.color})}}},{key:"_animateCircleGlow",value:function(t){y.drawCircleGlow(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:2*(1.33*this._radius+t),radStart:0,radEnd:2*Math.PI,colors:[{color:"rgba(0, 0, 0, 0)",index:.48},{color:this._averageHit?"#56D45B":"#48ABAF",index:.5},{color:"rgba(0, 0, 0, 0)",index:.52}]})}},{key:"_animateOscilloscopes",value:function(t){var e="#FFF";this._averageHit?(this._oscilloscopeRotation+=.05,e="rgba(255, 193, 140, .7)"):(this._oscilloscopeRotation+=-.05,e="rgba(125, 228, 132, 0.25)"),y.drawRadialOscilloscope(this._canvas,{points:this._points,times:t,length:this._fftSize/2,centerX:this._centerX,centerY:this._centerY,rotation:this._oscilloscopeRotation,color:e}),this._averageHit&&y.drawPointsOscilloscope(this._canvas,{times:t,length:this._fftSize/2,color:"rgba(113, 201, 205, .7)"})}},{key:"_getAverageFrequency",value:function(t){for(var e=0,i=0;i<t.length;++i)e+=t[i];return e/t.length}}]),o}(c),B=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:132;k(this,t),this.radius=.4,this.color="#0F8489",this.x=Math.random()*(2*e)-e,this.y=Math.random()*(2*i)-i,this._z=Math.max(2*e/(2*i)),this._maxDepth=Math.max(2*e/(2*i)),Math.abs(this.x)>Math.abs(this.y)?(this._dx=1,this._dy=Math.abs(this.y/this.x)):(this._dx=Math.abs(this.x/this.y),this._dy=1),this._dx*=this.x>0?1:-1,this._dy*=this.y>0?1:-1,this._dz=-.1,this.y>i/2?this.color="#71C9CD":n>o&&(this.color="#FF6B67")}return R(t,[{key:"updatePosition",value:function(t,e){this.x+=this._dx*t,this.y+=this._dy*t,this._z+=this._dz,this._dx+=.001*this._dx,this._dy+=.001*this._dy,this.radius=e+.1*(this._maxDepth-this._z)}}]),t}(),j=R((function t(e){k(this,t),this._height=e.height,this._width=e.width,this._total=e.total,this._index=e.index,this._value=256*Math.random(),this._radius=Math.abs(this._width)/8,this.angle=360*this._index/this._total,this.x=this._width/2+this._radius*Math.sin(Math.PI/180*this.angle),this.y=this._height/2+this._radius*Math.cos(Math.PI/180*this.angle),this.dx=this.x+this._value*Math.sin(Math.PI/180*this.angle),this.dy=this.y+this._value*Math.cos(Math.PI/180*this.angle)})),M=O;function D(t){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},D(t)}function I(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function z(t,e){return z=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},z(t,e)}function H(t,e){if(e&&("object"===D(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}var F=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&z(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=U(n);if(o){var i=U(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return H(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this))._merged=null,e._nodes={source:null,splitter:null,merger:null,analyser:null,analyserL:null,analyserR:null},e._canvasL=null,e._canvasR=null,e._ctxL=null,e._ctxR=null,e._fillAttributes(t),e._buildUI(),e._setAudioNodes(),e._addEvents(),e}return e=a,(i=[{key:"_fillAttributes",value:function(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize||1024,this._audioCtx=t.audioContext,this._inputNode=t.inputNode,this._merged=t.merged||!1}},{key:"_buildUI",value:function(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-".concat(this._type)),this._canvasL=document.createElement("canvas"),this._canvasR=document.createElement("canvas"),this._canvasL.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._canvasR.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctxL=this._canvasL.getContext("2d"),this._ctxR=this._canvasR.getContext("2d"),this._ctxL.translate(.5,.5),this._ctxR.translate(.5,.5),this._dom.container.appendChild(this._canvasL),this._dom.container.appendChild(this._canvasR),this._renderTo.appendChild(this._dom.container)}},{key:"_setAudioNodes",value:function(){var t,e=!1;if(this._audioCtx?(e=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player)),!0===this._merged?(this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),t=this._nodes.analyser):(this._nodes.splitter=this._audioCtx.createChannelSplitter(this._nodes.source.channelCount),this._nodes.merger=this._audioCtx.createChannelMerger(this._nodes.source.channelCount),this._nodes.analyserL=this._audioCtx.createAnalyser(),this._nodes.analyserR=this._audioCtx.createAnalyser(),this._nodes.analyserR.fftSize=this._fftSize,this._nodes.analyserL.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.splitter),this._nodes.splitter.connect(this._nodes.analyserL,0),this._nodes.splitter.connect(this._nodes.analyserR,1),this._nodes.analyserL.connect(this._nodes.merger,0,0),this._nodes.analyserR.connect(this._nodes.merger,0,1),t=this._nodes.merger),e){var i=this._audioCtx.createGain();i.gain.value=0,t.connect(i),i.connect(this._audioCtx.destination)}else t.connect(this._audioCtx.destination)}},{key:"_clearCanvas",value:function(){this._canvasL.getContext("2d").clearRect(0,0,this._canvasL.width,this._canvasL.height),this._canvasR.getContext("2d").clearRect(0,0,this._canvasR.width,this._canvasR.height)}}])&&I(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(n);function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function q(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function W(){return W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=X(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},W.apply(this,arguments)}function X(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=V(t)););return t}function N(t,e){return N=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},N(t,e)}function Y(t,e){if(e&&("object"===G(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}var $=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&N(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=V(n);if(o){var i=V(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return Y(this,t)});function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this,t))._colors={signal:f.defaultPrimaryColor},t.colors&&t.colors.signal&&(e._colors.signal=t.colors.signal);var i=t.colors&&t.colors.background||f.defaultBackgroundColor;return!0===e._merged?e._canvas.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e._updateDimensions(),e}return e=a,(i=[{key:"_fillAttributes",value:function(t){W(V(a.prototype),"_fillAttributes",this).call(this,t),this._dimension={height:null,canvasHeight:null,width:null}}},{key:"_buildUI",value:function(){W(V(a.prototype),"_buildUI",this).call(this),!0===this._merged&&this._dom.container.removeChild(this._canvasR)}},{key:"_onResize",value:function(){W(V(a.prototype),"_onResize",this).call(this),this._updateDimensions()}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteTimeDomainData(t),y.drawOscilloscope(this._canvasL,{samples:this._nodes.analyser.frequencyBinCount,timeDomain:t,colors:this._colors.signal})}},{key:"_stereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyserL.frequencyBinCount);this._nodes.analyserL.getByteTimeDomainData(t),y.drawOscilloscope(this._canvasL,{samples:this._nodes.analyserL.frequencyBinCount,timeDomain:t,colors:this._colors.signal}),this._nodes.analyserR.getByteTimeDomainData(t),y.drawOscilloscope(this._canvasR,{samples:this._nodes.analyserR.frequencyBinCount,timeDomain:t,colors:this._colors.signal})}},{key:"_updateDimensions",value:function(){this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.width=this._renderTo.offsetWidth-2,this._dimension.canvasHeight=this._dimension.height/2,!0===this._merged?(this._canvasL.width=this._dimension.width,this._canvasL.height=2*this._dimension.canvasHeight):(this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight)}}])&&q(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(F);function J(t){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(t)}function K(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Q(){return Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=Z(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},Q.apply(this,arguments)}function Z(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=it(t)););return t}function tt(t,e){return tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},tt(t,e)}function et(t,e){if(e&&("object"===J(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function it(t){return it=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},it(t)}var nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&tt(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=it(n);if(o){var i=it(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return et(this,t)});function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),e=r.call(this,t),t.colors&&t.colors.gradient?e._peakGradient=t.colors.gradient:e._peakGradient=f.defaultAudioGradient;var i=t.colors&&t.colors.background||f.defaultBackgroundColor;return!0===e._merged?e._canvasL.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e}return e=a,(i=[{key:"_fillAttributes",value:function(t){Q(it(a.prototype),"_fillAttributes",this).call(this,t),this._orientation=t.orientation||"horizontal",this._legend=t.legend||null,this._legend?(this._dbScaleMin=t.legend.dbScaleMin||60,this._dbScaleTicks=t.legend.dbScaleTicks||15):(this._dbScaleMin=60,this._dbScaleTicks=15),this._amplitudeL=0,this._amplitudeR=0,this._peakL=0,this._peakR=0,this._peakSetTimeL=null,this._peakSetTimeR=null,this._dom.scaleContainer=null,this._dom.labels=[]}},{key:"_buildUI",value:function(){Q(it(a.prototype),"_buildUI",this).call(this),"horizontal"===this._orientation&&this._dom.container.classList.add("horizontal-peakmeter"),this._legend&&(this._dom.scaleContainer=document.createElement("DIV"),this._dom.scaleContainer.classList.add("scale-container"),this._dom.container.insertBefore(this._dom.scaleContainer,this._dom.container.firstChild)),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}},{key:"_setAudioNodes",value:function(){Q(it(a.prototype),"_setAudioNodes",this).call(this),this._peakSetTimeL=this._audioCtx.currentTime,this._peakSetTimeR=this._audioCtx.currentTime}},{key:"_pause",value:function(){Q(it(a.prototype),"_pause",this).call(this),this._legend&&(this._dom.labels[0].textContent="-∞",this._dom.labels[1].textContent="-∞")}},{key:"_onResize",value:function(){Q(it(a.prototype),"_onResize",this).call(this),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Float32Array(this._fftSize);this._nodes.analyser.getFloatTimeDomainData(t);for(var e=0,i=0;i<t.length;i++)e+=t[i]*t[i];var n=10*Math.log10(e/t.length),o=-1*this._dbScaleMin;"horizontal"===this._orientation?this._amplitudeL=Math.floor(n*this._canvasL.width/o):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(n*this._canvasL.height/o)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&n!==-1/0&&(this._dom.labels[0].textContent=y.precisionRound(n,1))),y.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient})}},{key:"_stereoAnalysis",value:function(){var t=new Float32Array(this._fftSize),e=new Float32Array(this._fftSize);this._nodes.analyserL.getFloatTimeDomainData(t),this._nodes.analyserR.getFloatTimeDomainData(e);for(var i=0,n=0,o=0;o<t.length;o++)i+=t[o]*t[o],n+=e[o]*e[o];var r=10*Math.log10(i/t.length),a=10*Math.log10(n/e.length),s=-1*this._dbScaleMin;"horizontal"===this._orientation?(this._amplitudeL=Math.floor(r*this._canvasL.width/s),this._amplitudeR=Math.floor(a*this._canvasR.width/s)):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(r*this._canvasL.height/s),this._amplitudeR=Math.floor(a*this._canvasR.height/s)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&r!==-1/0&&(this._dom.labels[0].textContent=y.precisionRound(r,1))),this._peakR>this._amplitudeR?(this._peakR=this._amplitudeR,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&a!==-1/0&&(this._dom.labels[1].textContent=y.precisionRound(a,1))):this._audioCtx.currentTime-this._peakSetTimeR>1&&(this._peakR=this._amplitudeL,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&a!==-1/0&&(this._dom.labels[1].textContent=y.precisionRound(a,1))),y.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient}),y.drawPeakMeter(this._canvasR,{amplitude:this._amplitudeR,peak:this._peakR,orientation:this._orientation,colors:this._peakGradient})}},{key:"_createScaleTicks",value:function(){var t=Math.floor(this._dbScaleMin/this._dbScaleTicks),e=0;if(this._dom.scaleContainer.innerHTML="","horizontal"===this._orientation)for(var i=this._canvasL.width/t,n=0;n<t;++n){var o=document.createElement("DIV");this._dom.scaleContainer.appendChild(o),o.style.width="".concat(i,"px"),o.textContent="".concat(e),e-=this._dbScaleTicks}else for(var r=this._canvasL.height/t,a=0;a<t;++a){var s=document.createElement("DIV");this._dom.scaleContainer.appendChild(s),s.style.height="".concat(r,"px"),s.textContent="".concat(e),e-=this._dbScaleTicks}}},{key:"_createPeakLabel",value:function(){2===this._dom.labels.length&&(this._dom.container.removeChild(this._dom.labels[0]),this._dom.container.removeChild(this._dom.labels[1]),this._dom.labels=[]);var t=document.createElement("DIV"),e=document.createElement("DIV");t.classList.add("peak-value-container"),e.classList.add("peak-value-container"),t.textContent="-∞",e.textContent="-∞","horizontal"===this._orientation?(t.style.width="28px",t.style.height="".concat(this._canvasL.height+2,"px"),t.style.top="14px",e.style.width="28px",e.style.height="".concat(this._canvasL.height+2,"px"),e.style.top="".concat(this._canvasL.height+16,"px")):(t.style.width="".concat(this._canvasL.width+2,"px"),t.style.left="18px",e.style.width="".concat(this._canvasL.width+2,"px"),e.style.left="".concat(this._canvasL.width+20,"px")),this._dom.labels.push(t),this._dom.labels.push(e),this._dom.container.appendChild(this._dom.labels[0]),this._dom.container.appendChild(this._dom.labels[1])}},{key:"_updateDimensions",value:function(){var t=0,e=0;"horizontal"===this._orientation?(this._legend&&(t=30,e=14),this._canvasL.width=this._renderTo.offsetWidth-t,!0===this._merged?(this._canvasL.height=this._renderTo.offsetHeight-e-2,this._canvasR.height=this._renderTo.offsetHeight-e-2):(this._canvasR.width=this._renderTo.offsetWidth-t,this._canvasL.height=(this._renderTo.offsetHeight-e)/2-2,this._canvasR.height=(this._renderTo.offsetHeight-e)/2-2),this._legend&&(this._dom.scaleContainer.style.width="".concat(this._canvasL.width,"px"))):"vertical"===this._orientation&&(this._legend?(t=18,e=16):this._canvasL.style.left="0",this._canvasL.height=this._renderTo.offsetHeight-e-2,!0===this._merged?(this._canvasL.width=this._renderTo.offsetWidth-t-2,this._canvasR.width=this._renderTo.offsetWidth-t-2):(this._canvasR.height=this._renderTo.offsetHeight-e-2,this._canvasL.width=(this._renderTo.offsetWidth-t)/2-2,this._canvasR.width=(this._renderTo.offsetWidth-t)/2-2),this._legend&&(this._dom.scaleContainer.style.height="".concat(this._canvasL.height,"px"),this._dom.scaleContainer.style.width="18px"))}}])&&K(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(F);function ot(t){return ot="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot(t)}function rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function at(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function st(){return st="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=lt(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},st.apply(this,arguments)}function lt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ut(t)););return t}function ct(t,e){return ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ct(t,e)}function ht(t,e){if(e&&("object"===ot(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}var dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ct(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ut(n);if(o){var i=ut(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return ht(this,t)});function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this,t))._updateDimensions(),e._createLogarithmicScaleHeights();var i="black";return!0===e._merged?e._canvasL.style.backgroundColor=i:(e._canvasL.style.backgroundColor=i,e._canvasR.style.backgroundColor=i),e}return e=a,(i=[{key:"_fillAttributes",value:function(t){st(ut(a.prototype),"_fillAttributes",this).call(this,t),this._scaleType=t.scale||"linear",this._colorSmoothing=t.colorSmoothing||!1,this._canvasSpeed=1,this._bufferCanvas=null,this._bufferCtx=null,this._dom.settings=null,this._dom.settingsPanel=null,this._dimension={height:null,canvasHeight:null,width:null},this._logScale=[],this._settingsClicked=this._settingsClicked.bind(this),this._clickedElsewhere=this._clickedElsewhere.bind(this)}},{key:"_buildUI",value:function(){var t=this;st(ut(a.prototype),"_buildUI",this).call(this),this._bufferCanvas=document.createElement("CANVAS"),this._bufferCtx=this._bufferCanvas.getContext("2d"),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight,this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight;var e=new DOMParser;this._dom.settings=e.parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 13.616v-3.232c-1.651-.587-2.694-.752-3.219-2.019v-.001c-.527-1.271.1-2.134.847-3.707l-2.285-2.285c-1.561.742-2.433 1.375-3.707.847h-.001c-1.269-.526-1.435-1.576-2.019-3.219h-3.232c-.582 1.635-.749 2.692-2.019 3.219h-.001c-1.271.528-2.132-.098-3.707-.847l-2.285 2.285c.745 1.568 1.375 2.434.847 3.707-.527 1.271-1.584 1.438-3.219 2.02v3.232c1.632.58 2.692.749 3.219 2.019.53 1.282-.114 2.166-.847 3.707l2.285 2.286c1.562-.743 2.434-1.375 3.707-.847h.001c1.27.526 1.436 1.579 2.019 3.219h3.232c.582-1.636.75-2.69 2.027-3.222h.001c1.262-.524 2.12.101 3.698.851l2.285-2.286c-.744-1.563-1.375-2.433-.848-3.706.527-1.271 1.588-1.44 3.221-2.021zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/></svg>',"image/svg+xml").documentElement,this._dom.settings.classList.add("audio-spectrum-settings"),this._dom.settingsPanel=document.createElement("DIV"),this._dom.settingsPanel.classList.add("audio-spectrum-settings-panel"),this._dom.settingsPanel.innerHTML='\n      <h3>Settings</h3>\n      <form>\n        <p class="legend">Scale:</p>\n        <label for="linear">Linear</label>\n        <input type="radio" id="id-linear" name="scale" value="linear" '.concat("linear"===this._scaleType?"checked":"",'>\n        <label for="logarithmic">Logarithmic</label>\n        <input type="radio" id="id-logarithmic" name="scale" value="logarithmic" ').concat("logarithmic"===this._scaleType?"checked":"",'>\n        <p class="smooth-color">\n          <label for="smoothColor">Smooth colors</label>\n          <input type="checkbox" id="smoothColor" name="smoothColor" ').concat(this._colorSmoothing?"checked":"",">\n        </p>\n      </form>\n    ");var i=this._dom.settingsPanel.querySelector("form");i.addEventListener("change",(function(e){e.preventDefault();var n,o=[],r=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return rt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?rt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){s=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw r}}}}(new FormData(i));try{for(r.s();!(n=r.n()).done;){var a=n.value;o.push(a[1])}}catch(t){r.e(t)}finally{r.f()}t._scaleType=o[0],t._colorSmoothing="on"===o[1]}),!1),this._dom.container.appendChild(this._dom.settingsPanel),this._dom.container.appendChild(this._dom.settings),this._dom.settings.addEventListener("click",this._settingsClicked,!1)}},{key:"_removeEvents",value:function(){st(ut(a.prototype),"_removeEvents",this).call(this),document.body.removeEventListener("click",this._clickedElsewhere,!1)}},{key:"_onResize",value:function(){st(ut(a.prototype),"_onResize",this).call(this),this._updateDimensions(),this._createLogarithmicScaleHeights(),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,!1===this._merged&&(this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight),this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}},{key:"_mergedStereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._drawSpectrogramForFrequencyBin(this._canvasL,t)}},{key:"_stereoAnalysis",value:function(){var t=new Uint8Array(this._nodes.analyserL.frequencyBinCount),e=new Uint8Array(this._nodes.analyserR.frequencyBinCount);this._nodes.analyserL.getByteFrequencyData(t),this._nodes.analyserR.getByteFrequencyData(e),this._drawSpectrogramForFrequencyBin(this._canvasL,t),this._drawSpectrogramForFrequencyBin(this._canvasR,e)}},{key:"_updateDimensions",value:function(){this._dimension.width=this._renderTo.offsetWidth-2,!0===this._merged?(this._dimension.height=this._renderTo.offsetHeight-2,this._dimension.canvasHeight=this._dimension.height):(this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.canvasHeight=this._dimension.height/2)}},{key:"_settingsClicked",value:function(){!1===this._dom.settingsPanel.classList.contains("opened")&&(this._dom.settings.classList.add("opened"),this._dom.settingsPanel.classList.add("opened"),document.body.addEventListener("click",this._clickedElsewhere,!1))}},{key:"_clickedElsewhere",value:function(t){t.target.closest(".audio-spectrum-settings")||t.target.closest(".audio-spectrum-settings-panel")||(this._dom.settings.classList.remove("opened"),this._dom.settingsPanel.classList.remove("opened"),document.body.removeEventListener("click",this._clickedElsewhere,!1))}},{key:"_drawSpectrogramForFrequencyBin",value:function(t,e){var i=t.getContext("2d");this._bufferCtx.drawImage(t,0,0,this._dimension.width,this._dimension.canvasHeight);for(var n=0;n<e.length;++n)"linear"===this._scaleType?this._fillRectLinear(i,e,n):this._fillRectLogarithm(i,e,n);i.translate(-this._canvasSpeed,0),i.drawImage(this._bufferCanvas,0,0,this._dimension.width,this._dimension.canvasHeight,0,0,this._dimension.width,this._dimension.canvasHeight),i.setTransform(1,0,0,1,0,0)}},{key:"_fillRectLinear",value:function(t,e,i){var n=this._scaleLinearIndexToHeight(i),o=this._dimension.canvasHeight/e.length;if(0!==i&&this._colorSmoothing){var r=t.createLinearGradient(0,this._dimension.canvasHeight-n-o,0,this._dimension.canvasHeight-n);r.addColorStop(0,"rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")")),r.addColorStop(1,"rgb(".concat(e[i-1],", ").concat(e[i-1],", ").concat(e[i-1],")")),t.fillStyle=r}else t.fillStyle="rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")");t.fillRect(this._dimension.width-this._canvasSpeed,this._dimension.canvasHeight-n-o,this._canvasSpeed,o)}},{key:"_fillRectLogarithm",value:function(t,e,i){if(0!==i&&i!==e.length-1&&this._colorSmoothing){var n=t.createLinearGradient(0,this._logScale[i],0,this._logScale[i-1]);n.addColorStop(0,"rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")")),n.addColorStop(1,"rgb(".concat(e[i-1],", ").concat(e[i-1],", ").concat(e[i-1],")")),t.fillStyle=n}else t.fillStyle="rgb(".concat(e[i],", ").concat(e[i],", ").concat(e[i],")");t.fillRect(this._dimension.width-this._canvasSpeed,this._logScale[i-1],this._canvasSpeed,this._logScale[i]-this._logScale[i-1])}},{key:"_scaleLinearIndexToHeight",value:function(t){var e=this._fftSize/2;return t*this._dimension.canvasHeight/e}},{key:"_createLogarithmicScaleHeights",value:function(){var t=this;return new Promise((function(e){t._logScale=[t._dimension.canvasHeight];for(var i=1;i<t._fftSize/2;++i)t._logScale.push(t._computeLogSampleHeight(i));e()}))}},{key:"_computeLogSampleHeight",value:function(t){return this._dimension.canvasHeight-Math.log(t)/Math.log(10)/(Math.log(this._fftSize/2)/Math.log(10))*this._dimension.canvasHeight}}])&&at(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(F);function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function pt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yt(){return yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=vt(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},yt.apply(this,arguments)}function vt(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=bt(t)););return t}function gt(t,e){return gt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},gt(t,e)}function mt(t,e){if(e&&("object"===ft(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function bt(t){return bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},bt(t)}var wt=32e3,Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gt(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=bt(n);if(o){var i=bt(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return mt(this,t)});function a(t){var e,i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this,t))._colors={background:t.colors&&t.colors.background||f.defaultBackgroundColor,track:t.colors&&t.colors.track||f.defaultDarkPrimaryColor,mainBeat:t.colors&&t.colors.mainBeat||f.defaultPrimaryColor,subBeat:t.colors&&t.colors.subBeat||f.defaultAntiPrimaryColor,loop:t.colors&&t.colors.loop||f.defaultLoopColor,loopAlpha:t.colors&&t.colors.loopAlpha||f.defaultLoopAlphaColor},e._canvas.style.backgroundColor=e._colors.background,e._canvasSpeed=t.speed?t.speed:5,e._beat={offset:t.beat?t.beat.offset:null,bpm:t.beat?t.beat.bpm:null,timeSignature:t.beat?t.beat.timeSignature:null},e._wave={align:t.wave&&t.wave.align||"center",scale:t.wave&&t.wave.scale||.95},e._hotCues=function(t){if(Array.isArray(t))return _t(t)}(i=t.hotCues)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||function(t,e){if(t){if("string"==typeof t)return _t(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_t(t,e):void 0}}(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()||[],e._beatsArray=[],e._beatCount="0.0",e._loopEntry=null,e._loopEnd=null,e._loopBuffer=null,e._isLooping=!1,e._loopStartedAt=0,e._playerPausedAt=0,e._audioBuffer=null,e._canvases=[],e._cueCanvases=[],e._beatCanvases=[],e._loopCanvases=[],e._isDragging=!1,e._wasPlaying=!1,e._draggedTime=0,e._startDrag={x:0,y:0},""!==e._player.src&&e._getPlayerSourceFile(),e}return e=a,i=[{key:"_fillAttributes",value:function(t){yt(bt(a.prototype),"_fillAttributes",this).call(this,t),this._offlineCtx=null,this._offlineBuffer=null,this._trackLoaded=this._trackLoaded.bind(this),this._onProgress=this._onProgress.bind(this),this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this)}},{key:"_addEvents",value:function(){yt(bt(a.prototype),"_addEvents",this).call(this),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._player.addEventListener("timeupdate",this._onProgress,!1),this._canvas.addEventListener("mousedown",this._mouseDown,!1),this._player.paused||(this._isPlaying=!0,requestAnimationFrame(this._processAudioBin))}},{key:"_removeEvents",value:function(){yt(bt(a.prototype),"_removeEvents",this).call(this),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._player.removeEventListener("timeupdate",this._onProgress,!1)}},{key:"_onResize",value:function(){yt(bt(a.prototype),"_onResize",this).call(this),this._fillData(),this._clearCanvas(),this._drawTimeline(this._player.currentTime)}},{key:"_clearCanvas",value:function(t,e,i){if(yt(bt(a.prototype),"_clearCanvas",this).call(this),t)for(var n=0;n<this._beatCanvases.length;++n)this._beatCanvases[n].getContext("2d").clearRect(0,0,this._beatCanvases[n].width,this._beatCanvases[n].height);if(e)for(var o=0;o<this._cueCanvases.length;++o)this._cueCanvases[o].getContext("2d").clearRect(0,0,this._cueCanvases[o].width,this._cueCanvases[o].height);if(i)for(var r=0;r<this._loopCanvases.length;++r)this._loopCanvases[r].getContext("2d").clearRect(0,0,this._loopCanvases[r].width,this._loopCanvases[r].height)}},{key:"_dblClick",value:function(){}},{key:"_processAudioBin",value:function(){!0!==this._isPlaying&&!0!==this._isLooping||(!0===this._isLooping&&(this._player.currentTime=this._loopEntry.time+(this._playerPausedAt+this._audioCtx.currentTime-this._loopStartedAt)%(this._loopEnd.time-this._loopEntry.time)),this._clearCanvas(),this._drawTimeline(this._player.currentTime),requestAnimationFrame(this._processAudioBin))}},{key:"_startLoopSequence",value:function(t){var e=this;t&&(this._player.currentTime=this._loopEntry.time);var i=this._audioBuffer.slice();this._audioCtx.decodeAudioData(i,(function(t){e._loopBuffer=e._audioCtx.createBufferSource(),e._loopBuffer.buffer=t,e._loopBuffer.connect(e._audioCtx.destination),e._loopBuffer.loop=!0,e._loopBuffer.loopStart=e._loopEntry.time,e._loopBuffer.loopEnd=e._loopEnd.time,e._loopBuffer.start(0,e._player.currentTime),e._player.pause(),e._loopStartedAt=e._audioCtx.currentTime,e._playerPausedAt=e._player.currentTime,e._isLooping=!0,e._processAudioBin()}))}},{key:"_trackLoaded",value:function(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}},{key:"_onProgress",value:function(){this._clearCanvas(),this._drawTimeline(this._player.currentTime||0)}},{key:"_mouseDown",value:function(t){var e=t.target.getBoundingClientRect(),i=(t.clientX-e.left-this._canvas.width/2+this._player.currentTime/this._canvasSpeed*this._canvas.width)%wt,n=t.clientY-e.top,o=this._hotCueClicked(i,n);o?(this._player.currentTime=o.time,this._clearCanvas(),this._drawTimeline(this._player.currentTime)):(this._isDragging=!0,this._startDrag.x=t.clientX,this._startDrag.y=t.clientY,!1===this._player.paused&&(this._wasPlaying=!0,this._player.pause()),this._canvas.addEventListener("mousemove",this._mouseMove,!1),this._canvas.addEventListener("mouseup",this._mouseUp,!1),this._canvas.addEventListener("mouseout",this._mouseUp,!1))}},{key:"_mouseMove",value:function(t){if(!0===this._isDragging){var e=(this._startDrag.x-t.clientX)*this._canvasSpeed/this._canvas.width*2;this._draggedTime=this._player.currentTime+e,this._clearCanvas(),this._drawTimeline(this._draggedTime)}}},{key:"_mouseUp",value:function(){this._isDragging=!1,this._startDrag.x=0,this._startDrag.y=0,this._player.currentTime=this._draggedTime||this._player.currentTime,this._draggedTime=null,!0===this._wasPlaying&&(this._wasPlaying=!1,this._player.play()),this._canvas.removeEventListener("mousemove",this._mouseMove,!1),this._canvas.removeEventListener("mouseup",this._mouseUp,!1),this._canvas.removeEventListener("mouseout",this._mouseUp,!1)}},{key:"_processAudioFile",value:function(t){var e=this;this._audioBuffer=t.slice(),this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,(function(t){e._offlineSource.buffer=t,e._offlineSource.connect(e._offlineCtx.destination),e._offlineSource.start(),e._offlineCtx.startRendering().then((function(t){e._offlineBuffer=t,e._fillData(),e._drawTimeline(e._player.currentTime||0)})).catch((function(t){console.log("Rendering failed: "+t)}))}))}},{key:"_fillData",value:function(){if(this._offlineBuffer){this._canvases=[],this._cueCanvases=[],this._beatCanvases=[],this._loopCanvases=[];for(var t=this._genScaledMonoData(this._offlineBuffer),e=this._canvasSpeed*this._offlineBuffer.sampleRate/this._canvas.width,i=Math.round(this._offlineBuffer.duration/this._canvasSpeed*this._canvas.width),n=0;n<i;n+=wt){var o=document.createElement("CANVAS"),r=o.getContext("2d"),a=document.createElement("CANVAS"),s=document.createElement("CANVAS"),l=document.createElement("CANVAS"),c=i-n;c=c>wt?wt:c,o.width=c,o.height=this._canvas.height,a.width=c,a.height=this._canvas.height,s.width=c,s.height=this._canvas.height,l.width=c,l.height=this._canvas.height,r.clearRect(0,0,i,this._canvas.height);for(var h=0;h<c;++h){for(var u=Math.floor((n+h)*e),d=0,_=0;_<e;++_)t[u+_]>d&&(d=t[u+_]);r.fillStyle=f.lightenDarkenColor(this._colors.track,190*d),d=Math.floor(d*(this._canvas.height*this._wave.scale)),"center"===this._wave.align?(r.fillRect(h,this._canvas.height/2,1,-d/2),r.fillRect(h,this._canvas.height/2,1,d/2),r.fillRect(h,this._canvas.height/2-.5,1,1)):"top"===this._wave.align?r.fillRect(h,1,1,d):"bottom"===this._wave.align&&r.fillRect(h,this._canvas.height-1,1,-d)}this._canvases.push(o),this._cueCanvases.push(a),this._beatCanvases.push(s),this._loopCanvases.push(l)}null!==this._beat.bpm&&null!==this._beat.offset&&this._fillBeatBars({totalWidth:this._offlineBuffer.duration/this._canvasSpeed*this._canvas.width,beatWidth:1/(this._beat.bpm/60)/this._canvasSpeed*this._canvas.width,beatOffset:this._beat.offset/this._canvasSpeed*this._canvas.width}),this._drawHotCues()}}},{key:"_fillBeatBars",value:function(t){for(var e=t.beatOffset,i=0,n=0;n<Math.floor(t.totalWidth/t.beatWidth);++n){if(n*t.beatWidth+e>=wt+i*wt)for(++i;1<i;++n)e+=t.beatWidth-(32e3-this._beatsArray[this._beatsArray.length-1].xPos%32e3);this._drawBeatBar(n,n*t.beatWidth+e,i)}}},{key:"_drawBeatBar",value:function(t,e,i){var n=this._beatCanvases[i],o=n.getContext("2d");t%this._beat.timeSignature==0?o.fillStyle="white":o.fillStyle="grey",o.fillRect(e%wt,9,1,this._canvas.height-18),t%this._beat.timeSignature==0?o.fillStyle=this._colors.mainBeat:o.fillStyle=this._colors.subBeat,y.drawTriangle(n,{x:e%wt,y:1,radius:6,top:10}),y.drawTriangle(n,{x:e%wt,y:this._canvas.height-1,radius:6,top:this._canvas.height-10}),this._beatsArray.push({primaryBeat:t%this._beat.timeSignature==0,beatCount:t,xPos:e,time:e*this._canvasSpeed/this._canvas.width,canvasIndex:i})}},{key:"_genScaledMonoData",value:function(t){for(var e=t.getChannelData(0),i=t.getChannelData(1),n=[],o=0;o<e.length;++o)n.push((Math.abs(e[o])+Math.abs(i[o]))/2);return n}},{key:"_drawTimeline",value:function(t){var e=Math.floor(t*this._canvas.width/this._canvasSpeed),i=Math.floor((e-this._canvas.width/2)/wt);i<0&&(i=0);var n=Math.floor((e+this._canvas.width/2)/wt);n>=this._canvases.length&&(n=this._canvases.length-1);for(var o=i;o<=n;++o)this._ctx.drawImage(this._canvases[o],this._canvas.width/2-e+wt*o,0),this._ctx.drawImage(this._beatCanvases[o],this._canvas.width/2-e+wt*o,0),this._ctx.drawImage(this._cueCanvases[o],this._canvas.width/2-e+wt*o,0),this._ctx.drawImage(this._loopCanvases[o],this._canvas.width/2-e+wt*o,0);if(this._ctx.fillStyle=f.defaultAntiPrimaryColor,this._ctx.fillRect(this._canvas.width/2,1,3,this._canvas.height-2),this._ctx.strokeStyle="black",this._ctx.lineWidth=1,this._ctx.strokeRect(this._canvas.width/2,1,3,this._canvas.height-2),this._beatsArray.length>0){for(var r="0.0",a=0;a<this._beatsArray.length;++a)if(t<=this._beatsArray[a].time){var s=Math.floor((this._beatsArray[a].beatCount-1)/this._beat.timeSignature)+1,l=(this._beatsArray[a].beatCount-1)%this._beat.timeSignature;r="".concat(s,".").concat(-1===l?1:l+1);break}var c=14;"top"===this._wave.align&&(c=this._canvas.height-4),y.drawBeatCount(this._canvas,{label:r,x:this._canvas.width/2+8,y:c})}}},{key:"_drawHotCues",value:function(){for(var t=0;t<this._hotCues.length;++t)this._drawHotCue(this._hotCues[t])}},{key:"_drawHotCue",value:function(t){var e=2;"top"===this._wave.align&&(e=this._canvas.height-20),y.drawHotCue(this._cueCanvases[t.canvasIndex],{x:t.xPos-t.canvasIndex*wt+9,y:e,size:18,label:t.label||t.number,color:t.color})}},{key:"_hotCueClicked",value:function(t,e){if(e>2&&e<20)for(var i=0;i<this._hotCues.length;++i){var n=this._hotCues[i].xPos-this._hotCues[i].canvasIndex*wt;if(t>n&&t<n+18)return this._hotCues[i]}return!1}},{key:"_drawLoop",value:function(){if(this._loopEntry&&(this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d").fillStyle=this._colors.loop,y.drawTriangle(this._loopCanvases[this._loopEntry.canvasIndex],{x:this._loopEntry.xPos%wt+1,y:1,radius:9,top:14}),y.drawTriangle(this._loopCanvases[this._loopEntry.canvasIndex],{x:this._loopEntry.xPos%wt+1,y:this._loopCanvases[this._loopEntry.canvasIndex].height-1,radius:9,top:this._loopCanvases[this._loopEntry.canvasIndex].height-14})),this._loopEnd&&(this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d").fillStyle=this._colors.loop,y.drawTriangle(this._loopCanvases[this._loopEnd.canvasIndex],{x:this._loopEnd.xPos%wt+1,y:1,radius:9,top:14}),y.drawTriangle(this._loopCanvases[this._loopEnd.canvasIndex],{x:this._loopEnd.xPos%wt+1,y:this._loopCanvases[this._loopEnd.canvasIndex].height-1,radius:9,top:this._loopCanvases[this._loopEnd.canvasIndex].height-14})),this._loopEntry&&this._loopEnd){var t=this._loopCanvases[this._loopEntry.canvasIndex].getContext("2d");t.fillStyle=this._colors.loopAlpha,this._loopEntry.canvasIndex===this._loopEnd.canvasIndex&&t.fillRect(this._loopEntry.xPos,30,this._loopEnd.xPos-this._loopEntry.xPos,this._loopCanvases[this._loopEntry.canvasIndex].height-60)}}},{key:"_getPlayerSourceFile",value:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this._player.src,!0),e.responseType="arraybuffer",e.onload=function(){t._processAudioFile(e.response)},e.send()}},{key:"updateBeatInfo",value:function(t){this._beat={offset:t.offset,bpm:t.bpm,timeSignature:t.timeSignature}}},{key:"setHotCuePoint",value:function(t){for(var e=this.getClosestBeat(),i=null,n=0;n<this._hotCues.length;++n)if(this._hotCues[n].beatCount===e.beatCount){i=this._hotCues[n];break}return i||(e.number=this._hotCues.length+1,e.time=e.xPos*this._canvasSpeed/this._canvas.width,e.label=this._hotCues.length+1,t.label&&(e.label=t.label),t.color&&(e.color=t.color),this._hotCues.push(e),this._clearCanvas(),this._drawHotCue(e),this._drawTimeline(this._player.currentTime),e)}},{key:"updateHotCuePoint",value:function(t,e){for(var i=0;i<this._hotCues.length;++i)this._hotCues[i].beatCount===t.beatCount&&(e.label&&(this._hotCues[i].label=e.label),e.color&&(this._hotCues[i].color=e.color));this._clearCanvas(!1,!0),this._drawHotCues(),this._drawTimeline(this._player.currentTime)}},{key:"removeHotCuePoint",value:function(t){for(var e=0;e<this._hotCues.length;++e)if(this._hotCues[e].beatCount===t.beatCount){this._hotCues.splice(e,1),this._clearCanvas(!1,!0),this._drawHotCues(),this._drawTimeline(this._player.currentTime);break}}},{key:"setLoopEntryPoint",value:function(){this._loopEntry=this.getClosestBeat(),this._clearCanvas(!1,!1,!0),this._drawLoop(),this._drawTimeline(this._player.currentTime)}},{key:"setLoopEndPoint",value:function(t){if(this._loopEntry){if(t)this._loopEntry.beatCount+t<this._beatsArray.length?this._loopEnd=this._beatsArray[this._loopEntry.beatCount+t]:this._loopEnd=this._beatsArray[this._beatsArray.length-1];else{var e=this.getClosestBeat();e!==this._loopEntry&&this._loopEntry.time<e.time&&(this._loopEnd=e)}this._clearCanvas(!1,!1,!0),this._drawLoop(),this._drawTimeline(this._player.currentTime)}}},{key:"exitLoop",value:function(){this._loopEntry=null,this._loopEnd=null,this._loopBuffer=null,this._isLooping=!1,this._loopStartedAt=0,this._playerPausedAt=0,this._clearCanvas(!1,!1,!0),this._drawTimeline(this._player.currentTime)}},{key:"getClosestBeat",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Math.floor(this._player.currentTime*this._canvas.width/this._canvasSpeed),i={},n=0;n<this._beatsArray.length;++n)if(this._beatsArray[n].xPos>e){if(n-1>0&&this._beatsArray[n].xPos-e>e-this._beatsArray[n-1].xPos){i=this._beatsArray[n-1];break}i=this._beatsArray[n];break}return t?i.time:i}}],i&&pt(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(c),xt=Ct;function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function St(t){return function(t){if(Array.isArray(t))return Rt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Rt(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Rt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function Pt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Et(){return Et="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=At(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},Et.apply(this,arguments)}function At(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ot(t)););return t}function Tt(t,e){return Tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Tt(t,e)}function Lt(t,e){if(e&&("object"===kt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ot(t){return Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Ot(t)}var Bt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Tt(t,e)}(a,t);var e,i,n,o,r=(n=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ot(n);if(o){var i=Ot(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return Lt(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=r.call(this,t))._colors={background:t.colors&&t.colors.background||f.defaultBackgroundColor,track:t.colors&&t.colors.track||f.defaultTextColor,progress:t.colors&&t.colors.progress||f.defaultPrimaryColor},e._canvas.style.backgroundColor=e._colors.background,""!==e._player.src&&e._getPlayerSourceFile(),e}return e=a,(i=[{key:"_fillAttributes",value:function(t){Et(Ot(a.prototype),"_fillAttributes",this).call(this,t),this._animation=t.animation,this._wave={align:t.wave&&t.wave.align||"center",barWidth:t.wave&&t.wave.barWidth||1,barMarginScale:t.wave?t.wave.barMarginScale/2:.125,merged:t.wave&&t.wave.merged||!0,noSignalLine:!!t.wave&&(t.wave.noSignalLine||!0)},this._hotCues=t.hotCues||[],this._bars=null,this._offlineCtx=null,this._offlineBuffer=null,this._dataL=[],this._dataR=[],this._trackLoaded=this._trackLoaded.bind(this),this._onProgress=this._onProgress.bind(this),this._onClick=this._onClick.bind(this)}},{key:"_buildUI",value:function(){Et(Ot(a.prototype),"_buildUI",this).call(this),this._bars=this._canvas.width/this._wave.barWidth}},{key:"_addEvents",value:function(){Et(Ot(a.prototype),"_addEvents",this).call(this),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._player.addEventListener("seeking",this._onProgress,!1),this._dom.container.addEventListener("click",this._onClick,!1)}},{key:"_removeEvents",value:function(){Et(Ot(a.prototype),"_removeEvents",this).call(this),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._player.removeEventListener("seeking",this._onProgress,!1),this._dom.container.removeEventListener("click",this._onClick,!1)}},{key:"_onResize",value:function(){Et(Ot(a.prototype),"_onResize",this).call(this),this._bars=this._canvas.width/this._wave.barWidth,this._fillData(),this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_onProgress",value:function(){this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_dblClick",value:function(){}},{key:"_processAudioBin",value:function(){!0===this._isPlaying&&(this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration),requestAnimationFrame(this._processAudioBin))}},{key:"_trackLoaded",value:function(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}},{key:"_onClick",value:function(t){var e=t.target.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,o=this._hotCueClicked(i,n);if(o)this._player.currentTime=o.time;else{var r=t.target.getBoundingClientRect(),a=t.clientX-r.left;this._player.currentTime=a/this._canvas.width*this._player.duration}this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"_processAudioFile",value:function(t){var e=this;this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,(function(t){e._offlineSource.buffer=t,e._offlineSource.connect(e._offlineCtx.destination),e._offlineSource.start(),e._offlineCtx.startRendering().then((function(t){e._offlineBuffer=t,e._fillData(),e._drawFileWaveform(e._player.currentTime/e._player.duration)})).catch((function(t){console.log("Rendering failed: "+t)}))}))}},{key:"_fillData",value:function(){this._offlineBuffer&&(!0===this._wave.merged?this._dataL=this._genScaledMonoData(this._offlineBuffer):(this._dataL=this._genScaledData(this._offlineBuffer.getChannelData(0)),this._dataR=this._genScaledData(this._offlineBuffer.getChannelData(1))))}},{key:"_genScaledData",value:function(t){for(var e=Math.floor(t.length/this._bars),i=[],n=0;n<=t.length-e;n+=e){for(var o=0,r=0;r<e;++r)o+=Math.abs(t[n+r]);i.push(o/e)}return this._scaleDataToHeight(i)}},{key:"_genScaledMonoData",value:function(t){for(var e=t.getChannelData(0),i=t.getChannelData(1),n=Math.floor(e.length/this._bars),o=[],r=0;r<=e.length-n;r+=n){for(var a=0,s=0;s<n;++s)a+=(Math.abs(e[r+s])+Math.abs(i[r+s]))/2;o.push(a/n)}return this._scaleDataToHeight(o)}},{key:"_scaleDataToHeight",value:function(t){for(var e=Math.max.apply(Math,St(t)),i=Math.min.apply(Math,St(t)),n=e-i,o=.9*this._canvas.height,r=[],a=0;a<t.length;++a)r.push((t[a]-i)*o/n);return r}},{key:"_drawFileWaveform",value:function(t){var e=this._canvas.width/this._bars,i=e*this._wave.barMarginScale;this._ctx.beginPath();for(var n=0;n<this._dataL.length;++n){var o=this._dataL[n]/2,r=!0===this._wave.merged?this._dataL[n]/2:this._dataR[n]/2;if(this._ctx.fillStyle=this._colors.track,e*(n+1)/this._canvas.width>t&&e*n/this._canvas.width<t){var a=this._ctx.createLinearGradient(e*n+i,0,e*(n+1)-i,0),s=e*(n+1)-e*n,l=t*this._canvas.width,c=Math.abs(l-e*n)/s;if("gradient"===this._animation)c+.01<1?(a.addColorStop(0,this._colors.progress),a.addColorStop(c,this._colors.progress),a.addColorStop(c+.01,this._colors.track),a.addColorStop(1,this._colors.track),this._ctx.fillStyle=a):this._ctx.fillStyle=this._colors.progress;else{var h=Math.round(255*c);this._ctx.fillStyle=f.lightenDarkenColor(this._colors.progress,255-h)}}else n/this._dataL.length<t&&(this._ctx.fillStyle=this._colors.progress);"center"===this._wave.align?(this._ctx.fillRect(e*n+i,this._canvas.height/2-o,e-2*i,o),this._ctx.fillRect(e*n+i,this._canvas.height/2,e-2*i,r),this._wave.noSignalLine&&this._ctx.fillRect(e*n+i,this._canvas.height/2-.5,e-2*i,1)):"bottom"===this._wave.align?(this._ctx.fillRect(e*n+i,this._canvas.height-o,e-2*i,o),this._ctx.fillRect(e*n+i,this._canvas.height-o-r+1,e-2*i,r)):"top"===this._wave.align&&(this._ctx.fillRect(e*n+i,0,e-2*i,o),this._ctx.fillRect(e*n+i,o-1,e-2*i,r))}this._ctx.closePath(),this._drawHotCues()}},{key:"_drawHotCues",value:function(){for(var t=0;t<this._hotCues.length;++t)this._drawHotCue(this._hotCues[t])}},{key:"_drawHotCue",value:function(t){y.drawHotCue(this._canvas,{x:t.time*this._canvas.width/this._player.duration+9,y:2,size:18,label:t.label||t.number,color:t.color})}},{key:"_hotCueClicked",value:function(t,e){if(e>2&&e<20)for(var i=0;i<this._hotCues.length;++i){var n=this._hotCues[i].time*this._canvas.width/this._player.duration;if(t>n&&t<n+18)return this._hotCues[i]}return!1}},{key:"_getPlayerSourceFile",value:function(){var t=this,e=new XMLHttpRequest;e.open("GET",this._player.src,!0),e.responseType="arraybuffer",e.onload=function(){t._processAudioFile(e.response)},e.send()}},{key:"setHotCuePoint",value:function(t){for(var e=null,i=0;i<this._hotCues.length;++i)if(this._hotCues[i].beatCount===t.beatCount){e=this._hotCues[i];break}e||(this._hotCues.push(t),this._drawHotCues())}},{key:"updateHotCuePoint",value:function(t,e){for(var i=0;i<this._hotCues.length;++i)this._hotCues[i].beatCount===t.beatCount&&(e.label&&(this._hotCues[i].label=e.label),e.color&&(this._hotCues[i].color=e.color));this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}},{key:"removeHotCuePoint",value:function(t){for(var e=0;e<this._hotCues.length;++e)if(this._hotCues[e].beatCount===t.beatCount){this._hotCues.splice(e,1),this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration);break}}}])&&Pt(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(c);function jt(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}window.AudioContext=window.AudioContext||window.webkitAudioContext;var Mt=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"bars"===e.type?new C(e):"circle"===e.type?new M(e):"oscilloscope"===e.type?new $(e):"peakmeter"===e.type?new nt(e):"spectrum"===e.type?new dt(e):"timeline"===e.type?new xt(e):"waveform"===e.type?new Bt(e):null}var e,i;return e=t,i=[{key:"version",get:function(){return"0.9.8"}}],null&&jt(e.prototype,null),i&&jt(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();window.AudioVisualizer=Mt;var Dt=Mt;window.AudioVisualizer=e.default}();