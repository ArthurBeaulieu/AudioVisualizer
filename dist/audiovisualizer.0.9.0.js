!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){i(2),t.exports=i(1)},function(t,e,i){},function(t,e,i){"use strict";i.r(e);var s=class{constructor(t){this._type=null,this._player=null,this._renderTo=null,this._fftSize=null,this._audioCtx=null,this._inputNode=null,this._nodes={source:null,analyser:null},this._isPlaying=!1,this._canvas=null,this._ctx=null,this._parentDimension={position:null,height:null,width:null,zIndex:null},this._dom={container:null},this._resizeObserver=null,this._onResize=this._onResize.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._processAudioBin=this._processAudioBin.bind(this),this._dblClick=this._dblClick.bind(this),this._fillAttributes(t),this._buildUI(),this._setAudioNodes(),this._addEvents()}destroy(){this._removeEvents(),Object.keys(this).forEach(t=>{delete this[t]})}_fillAttributes(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize,this._audioCtx=t.audioContext,this._inputNode=t.inputNode}_buildUI(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-"+this._type),this._canvas=document.createElement("CANVAS"),this._canvas.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctx=this._canvas.getContext("2d"),this._ctx.translate(.5,.5),this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2,this._dom.container.appendChild(this._canvas),this._renderTo.appendChild(this._dom.container)}_setAudioNodes(){let t=!1;this._audioCtx?(t=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player)),this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),t||this._nodes.analyser.connect(this._audioCtx.destination)}_addEvents(){this._resizeObserver=new ResizeObserver(this._onResize),this._resizeObserver.observe(this._renderTo),this._player.addEventListener("play",this._play,!1),this._player.addEventListener("pause",this._pause,!1),this._dom.container.addEventListener("dblclick",this._dblClick,!1)}_removeEvents(){this._resizeObserver.disconnect(),this._player.removeEventListener("play",this._play,!1),this._player.removeEventListener("pause",this._pause,!1),this._dom.container.removeEventListener("dblclick",this._dblClick,!1)}_play(){this._isPlaying=!0,this._processAudioBin()}_pause(){this._isPlaying=!1}_onResize(){this._canvas.width=this._renderTo.offsetWidth-2,this._canvas.height=this._renderTo.offsetHeight-2}_dblClick(t){document.fullscreenElement?(document.exitFullscreen(),this._renderTo.style.position=this._parentDimension.position,this._renderTo.style.height=this._parentDimension.height,this._renderTo.style.width=this._parentDimension.width,this._renderTo.style.zIndex=this._parentDimension.zIndex,this._parentDimension={position:null,height:null,width:null,zIndex:null}):(document.documentElement.requestFullscreen(),this._parentDimension={position:this._renderTo.style.position,height:this._renderTo.style.height,width:this._renderTo.style.width,zIndex:this._renderTo.style.zIndex||""},this._renderTo.style.position="fixed",this._renderTo.style.height="100vh",this._renderTo.style.width="100vw",this._renderTo.style.zIndex="999")}_clearCanvas(){this._canvas.getContext("2d").clearRect(0,0,this._canvas.width,this._canvas.height)}};var a=class{constructor(){}static drawRadialGradient(t,e){const i=t.getContext("2d"),s=i.createRadialGradient(e.x0,e.y0,e.r0,e.x1,e.y1,e.r1);for(let t=0;t<e.colors.length;++t)s.addColorStop(e.colors[t].center,e.colors[t].color);i.fillStyle=s,i.fillRect(0,0,t.width,t.height)}static drawVerticalFrequencyGradient(t,e){const i=t.getContext("2d"),s=i.createLinearGradient(0,t.height,0,0);for(let t=0;t<e.colors.length;++t)s.addColorStop(e.colors[t].center,e.colors[t].color);i.fillStyle=s,i.fillRect(e.originX,t.height-e.frequencyHeight,e.frequencyWidth,e.frequencyHeight)}static drawRadialGlowGradient(t,e){const i=t.getContext("2d"),s=i.createRadialGradient(e.centerX,e.centerY,0,e.centerX,e.centerY,e.radius);for(let t=0;t<e.colors.length;++t)s.addColorStop(e.colors[t].center,e.colors[t].color);i.fillStyle=s,i.fill()}static peakMeterGradient(t,e){const i=t.getContext("2d");let s=null;if("horizontal"===e.orientation)s=i.createLinearGradient(0,0,t.width,0);else{if("vertical"!==e.orientation)return;s=i.createLinearGradient(0,t.height,0,0)}for(let t=0;t<e.colors.length;++t)s.addColorStop(e.colors[t].center,e.colors[t].color);i.fillStyle=s,i.fill()}static lightenDarkenColor(t,e){let i=!1;"#"===t[0]&&(t=t.slice(1),i=!0),e+=16;const s=parseInt(t,16);let a=(s>>16)+e;a>255?a=255:a<0&&(a=0);let n=(s>>8&255)+e;n>255?n=255:n<0&&(n=0);let o=(255&s)+e;return o>255?o=255:o<0&&(o=0),(i?"#":"")+(o|n<<8|a<<16).toString(16)}static rainbowGradient(t,e=!1){const i=t.getContext("2d");let s=i.createLinearGradient(0,0,t.width,0);return!0===e&&(s=i.createLinearGradient(0,0,0,t.height)),s.addColorStop(0,"red"),s.addColorStop(1/7,"orange"),s.addColorStop(2/7,"yellow"),s.addColorStop(3/7,"green"),s.addColorStop(4/7,"blue"),s.addColorStop(5/7,"indigo"),s.addColorStop(6/7,"violet"),s.addColorStop(1,"red"),s}static get defaultBackgroundColor(){return"#1D1E25"}static get defaultTextColor(){return"#E7E9E7"}static get defaultPrimaryColor(){return"#56D45B"}static get defaultAntiPrimaryColor(){return"#FF6B67"}static get defaultDarkPrimaryColor(){return"#12B31D"}static get defaultAudioGradient(){return["#56D45B","#AFF2B3","#FFAD67","#FF6B67","#FFBAB8"]}};var n=class{constructor(){}static drawRadialBar(t,e){const i=t.getContext("2d");let s=e.frequency/255;s<.05?s=-s:s*=1.33,i.beginPath(),i.moveTo(e.x0,e.y0),i.lineTo(e.x1,e.y1),i.strokeStyle=a.lightenDarkenColor(e.color,100*s),i.lineWidth=e.width,i.stroke(),i.closePath()}static drawCircle(t,e){const i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.lineWidth=e.width,i.strokeStyle=e.color||"#FFF",i.stroke(),i.closePath()}static drawCircleGlow(t,e){const i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),a.drawRadialGlowGradient(t,e),i.closePath()}static drawDisc(t,e){const i=t.getContext("2d");i.beginPath(),i.arc(e.centerX,e.centerY,e.radius,e.radStart,e.radEnd),i.fillStyle=e.color||"#FFF",i.fill(),i.closePath()}static drawVerticalFrequencyBar(t,e){const i=t.getContext("2d");i.beginPath(),i.fillRect(e.originX,t.height-e.frequencyHeight,e.frequencyWidth,e.frequencyHeight),a.drawVerticalFrequencyGradient(t,e),i.closePath()}static drawOscilloscope(t,e){const i=t.getContext("2d");i.beginPath();let s=0;const n=t.width/e.samples;for(let a=0;a<e.samples;++a){const o=e.timeDomain[a]/255,r=t.height*o;a>0?i.lineTo(s,r):i.moveTo(s,r),s+=n}"rainbow"===e.color?i.strokeStyle=a.rainbowGradient(t):i.strokeStyle=e.color,i.stroke(),i.closePath()}static drawPointsOscilloscope(t,e){const i=t.getContext("2d");i.beginPath();for(let s=0;s<e.length;++s){let a=t.height*(e.times[s]/255),n=t.height-a-1,o=t.width/e.length;i.fillStyle=e.color,i.fillRect(s*o,n,2,2)}i.stroke(),i.fill(),i.closePath()}static drawRadialOscilloscope(t,e){const i=t.getContext("2d");i.beginPath(),i.save(),i.translate(e.centerX,e.centerY),i.rotate(e.rotation),i.translate(-e.centerX,-e.centerY),i.moveTo(e.points[0].dx,e.points[0].dy);for(let t=0;t<e.length-1;++t){let s=e.points[t];s.dx=s.x+e.times[t]*Math.sin(Math.PI/180*s.angle),s.dy=s.y+e.times[t]*Math.cos(Math.PI/180*s.angle);let a=(s.dx+e.points[t+1].dx)/2,n=(s.dy+e.points[t+1].dy)/2;i.quadraticCurveTo(s.dx,s.dy,a,n)}let s=e.times[e.length-1],a=e.points[e.length-1];a.dx=a.x+s*Math.sin(Math.PI/180*a.angle),a.dy=a.y+s*Math.cos(Math.PI/180*a.angle);let n=(a.dx+e.points[0].dx)/2,o=(a.dy+e.points[0].dy)/2;i.quadraticCurveTo(a.dx,a.dy,n,o),i.quadraticCurveTo(n,o,e.points[0].dx,e.points[0].dy),i.lineWidth=1,i.lineCap="round",i.stroke(),i.restore(),i.closePath()}static drawPeakMeter(t,e){const i=t.getContext("2d");if(a.peakMeterGradient(t,e),"horizontal"===e.orientation){const s=t.width-e.amplitude;i.fillRect(0,0,s,t.height)}else if("vertical"===e.orientation){const s=t.height-e.amplitude;i.fillRect(0,t.height-s,t.width,s)}if(i.fillStyle="#FF6B67","horizontal"===e.orientation){const s=t.width-e.peak;i.fillRect(s,0,1,t.height)}else if("vertical"===e.orientation){const s=t.height-e.peak;i.fillRect(0,t.height-s,t.width,1)}}static drawTriangle(t,e,i,s,a){const n=t.getContext("2d");n.beginPath(),n.moveTo(e-s,i),n.lineTo(e+s,i),n.lineTo(e,a),n.fill(),n.closePath()}static precisionRound(t,e){const i=Math.pow(10,e||0);return Math.round(t*i)/i}};var o=class extends s{constructor(t){super(t),this._barGradient=[{color:t.colors&&t.colors.min||a.defaultAudioGradient[0],center:0},{color:t.colors&&t.colors.step0||a.defaultAudioGradient[1],center:.7},{color:t.colors&&t.colors.step1||a.defaultAudioGradient[2],center:.833},{color:t.colors&&t.colors.step2||a.defaultAudioGradient[3],center:.9},{color:t.colors&&t.colors.max||a.defaultAudioGradient[4],center:1}],this._canvas.style.backgroundColor=t.colors&&t.colors.background||a.defaultBackgroundColor}_processAudioBin(){if(!0===this._isPlaying){this._clearCanvas();const t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t);const e=this._canvas.width/this._nodes.analyser.frequencyBinCount;let i=0;for(let s=0;s<this._nodes.analyser.frequencyBinCount;++s){let a=t[s]/255*this._canvas.height;n.drawVerticalFrequencyBar(this._canvas,{frequencyHeight:a,frequencyWidth:e,colors:this._barGradient,originX:i}),i+=e}requestAnimationFrame(this._processAudioBin)}}};class r{constructor(t,e,i=0,s=132){this.radius=.4,this.color="#0F8489",this.x=Math.random()*(2*t)-t,this.y=Math.random()*(2*e)-e,this._z=Math.max(2*t/(2*e)),this._maxDepth=Math.max(2*t/(2*e)),Math.abs(this.x)>Math.abs(this.y)?(this._dx=1,this._dy=Math.abs(this.y/this.x)):(this._dx=Math.abs(this.x/this.y),this._dy=1),this._dx*=this.x>0?1:-1,this._dy*=this.y>0?1:-1,this._dz=-.1,this.y>e/2?this.color="#71C9CD":i>s&&(this.color="#FF6B67")}updatePosition(t,e){this.x+=this._dx*t,this.y+=this._dy*t,this._z+=this._dz,this._dx+=.001*this._dx,this._dy+=.001*this._dy,this.radius=e+.1*(this._maxDepth-this._z)}}class h{constructor(t){this._height=t.height,this._width=t.width,this._total=t.total,this._index=t.index,this._value=256*Math.random(),this._radius=Math.abs(this._width,this._height)/8,this.angle=360*this._index/this._total,this.x=this._width/2+this._radius*Math.sin(Math.PI/180*this.angle),this.y=this._height/2+this._radius*Math.cos(Math.PI/180*this.angle),this.dx=this.x+this._value*Math.sin(Math.PI/180*this.angle),this.dy=this.y+this._value*Math.cos(Math.PI/180*this.angle)}}var l=class extends s{constructor(t){super(t)}_fillAttributes(t){super._fillAttributes(t),this._imageSrc=null,this._centerX=null,this._centerY=null,this._radius=null,this._radialSection=null,this._barCount=null,this._barMaxHeight=null,this._circleStrokeWidth=null,this._stars=[],this._points=[],this._oscilloscopeRotation=null,this._dom.logo=null,this._averageBreakpoint=132,this._averageHit=!1,this._imageSrc=t.image||"assets/img/manazeak-logo-small.svg",this._dom.logo=document.createElement("IMG"),this._dom.logo.classList.add("paused"),this._dom.logo.src=this._imageSrc}_buildUI(){super._buildUI(),this._dom.container.appendChild(this._dom.logo),this._buildBackgroundBase()}_onResize(){super._onResize(),this._circleStrokeWidth=2,this._barCount=this._nodes.analyser.frequencyBinCount,this._centerX=this._canvas.width/2,this._centerY=this._canvas.height/2,this._barMaxHeight=this._canvas.height/8,this._radius=this._canvas.height/4-this._canvas.height/16,this._radialSection=2*Math.PI/this._barCount,this._stars=[];for(let t=0;t<1500;++t)this._stars.push(new r(this._centerX,this._centerY,null,this._averageBreakpoint));this._points=[];for(let t=0;t<this._fftSize/2;++t)this._points.push(new h({index:t,height:this._canvas.height,width:this._canvas.width,total:this._fftSize/2}));this._buildBackgroundBase()}_play(){super._play(),this._dom.logo.classList.remove("paused")}_pause(){super._pause(),this._dom.logo.classList.add("paused")}_processAudioBin(){if(!0===this._isPlaying){this._clearCanvas(),this._buildBackgroundBase();const t=new Uint8Array(this._nodes.analyser.frequencyBinCount),e=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._nodes.analyser.getByteTimeDomainData(e);let i=this._getAverageFrequency(t);this._averageHit=i>this._averageBreakpoint,this._animateCircleBars(t),this._animateStars(i),this._animateCircleGlow(i),this._animateOscilloscopes(e),requestAnimationFrame(this._processAudioBin)}}_buildBackgroundBase(){a.drawRadialGradient(this._canvas,{x0:this._centerX,y0:this._centerY,r0:this._radius,x1:this._centerX,y1:this._centerY,r1:this._canvas.width/2.66,colors:[{color:"#3C405D",center:0},{color:"#060609",center:1}]}),n.drawCircle(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:this._radius,radStart:0,radEnd:2*Math.PI,width:2*this._circleStrokeWidth})}_animateCircleBars(t){const e=Math.round(this._radialSection*this._radius);for(let i=0;i<t.length;++i){const s=t[i]/255*this._barMaxHeight;n.drawRadialBar(this._canvas,{x0:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),y0:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth),x1:this._centerX+Math.cos(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+s),y1:this._centerY+Math.sin(this._radialSection*i-Math.PI/2)*(this._radius+this._circleStrokeWidth+s),width:e,color:this._averageHit?"#56D45B":"#37C340",frequency:t[i]})}}_animateStars(t){let e=this._averageHit?t/20:t/60;for(let i=0;i<this._stars.length;++i){let s=this._stars[i];s.updatePosition(e,.6),(s.x<-this._centerX||s.x>this._centerX||s.y<-this._centerY||s.y>this._centerY)&&(s=new r(this._centerX,this._centerY,t,this._averageBreakpoint),this._stars[i]=s),n.drawDisc(this._canvas,{centerX:s.x+this._centerX,centerY:s.y+this._centerY,radius:s.radius,radStart:2*Math.PI,radEnd:!1,color:s.color})}}_animateCircleGlow(t){n.drawCircleGlow(this._canvas,{centerX:this._centerX,centerY:this._centerY,radius:2*(1.33*this._radius+t),radStart:0,radEnd:2*Math.PI,colors:[{color:"rgba(0, 0, 0, 0)",center:.48},{color:this._averageHit?"#56D45B":"#48ABAF",center:.5},{color:"rgba(0, 0, 0, 0)",center:.52}]})}_animateOscilloscopes(t){this._averageHit?(this._oscilloscopeRotation+=.05,this._ctx.strokeStyle="rgba(255, 193, 140, .7)"):(this._oscilloscopeRotation+=-.05,this._ctx.strokeStyle="rgba(125, 228, 132, 0.25)"),n.drawRadialOscilloscope(this._canvas,{points:this._points,times:t,length:this._fftSize/2,centerX:this._centerX,centerY:this._centerY,rotation:this._oscilloscopeRotation}),this._averageHit&&n.drawPointsOscilloscope(this._canvas,{times:t,length:this._fftSize/2,color:"rgba(113, 201, 205, .7)"})}_getAverageFrequency(t){let e=0;for(let i=0;i<t.length;++i)e+=t[i];return e/t.length}};var d=class{constructor(t){this._type=null,this._player=null,this._renderTo=null,this._fftSize=null,this._audioCtx=null,this._inputNode=null,this._merged=null,this._nodes={source:null,splitter:null,merger:null,analyser:null,analyserL:null,analyserR:null},this._canvasL=null,this._canvasR=null,this._ctxL=null,this._ctxR=null,this._dom={container:null},this._parentDimension={position:null,height:null,width:null,zIndex:null},this._resizeObserver=null,this._onResize=this._onResize.bind(this),this._play=this._play.bind(this),this._pause=this._pause.bind(this),this._processAudioBin=this._processAudioBin.bind(this),this._dblClick=this._dblClick.bind(this),this._fillAttributes(t),this._buildUI(),this._setAudioNodes(),this._addEvents()}destroy(){this._removeEvents(),Object.keys(this).forEach(t=>{delete this[t]})}_fillAttributes(t){this._type=t.type,this._player=t.player,this._renderTo=t.renderTo,this._fftSize=t.fftSize||1024,this._audioCtx=t.audioContext,this._inputNode=t.inputNode,this._merged=t.merged||!1}_buildUI(){this._dom.container=document.createElement("DIV"),this._dom.container.classList.add("audio-"+this._type),this._canvasL=document.createElement("canvas"),this._canvasR=document.createElement("canvas"),this._canvasL.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._canvasR.style.cssText="background-color:black;border: solid 1px #2c2c30;display:block;box-sizing:border-box;",this._ctxL=this._canvasL.getContext("2d"),this._ctxR=this._canvasR.getContext("2d"),this._ctxL.translate(.5,.5),this._ctxR.translate(.5,.5),this._dom.container.appendChild(this._canvasL),this._dom.container.appendChild(this._canvasR),this._renderTo.appendChild(this._dom.container)}_setAudioNodes(){let t=!1;this._audioCtx?(t=!0,this._nodes.source=this._inputNode):(this._audioCtx=new AudioContext,this._nodes.source=this._audioCtx.createMediaElementSource(this._player));let e=null;if(!0===this._merged?(this._nodes.analyser=this._audioCtx.createAnalyser(),this._nodes.analyser.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.analyser),e=this._nodes.analyser):(this._nodes.splitter=this._audioCtx.createChannelSplitter(this._nodes.source.channelCount),this._nodes.merger=this._audioCtx.createChannelMerger(this._nodes.source.channelCount),this._nodes.analyserL=this._audioCtx.createAnalyser(),this._nodes.analyserR=this._audioCtx.createAnalyser(),this._nodes.analyserR.fftSize=this._fftSize,this._nodes.analyserL.fftSize=this._fftSize,this._nodes.source.connect(this._nodes.splitter),this._nodes.splitter.connect(this._nodes.analyserL,0),this._nodes.splitter.connect(this._nodes.analyserR,1),this._nodes.analyserL.connect(this._nodes.merger,0,0),this._nodes.analyserR.connect(this._nodes.merger,0,1),e=this._nodes.merger),t){const t=this._audioCtx.createGain();t.gain.value=0,e.connect(t),t.connect(this._audioCtx.destination)}else e.connect(this._audioCtx.destination)}_addEvents(){this._resizeObserver=new ResizeObserver(this._onResize),this._resizeObserver.observe(this._renderTo),this._player.addEventListener("play",this._play,!1),this._player.addEventListener("pause",this._pause,!1),this._dom.container.addEventListener("dblclick",this._dblClick,!1)}_removeEvents(){this._resizeObserver.disconnect(),this._player.removeEventListener("play",this._play,!1),this._player.removeEventListener("pause",this._pause,!1),this._dom.container.removeEventListener("dblclick",this._dblClick,!1)}_play(){this._isPlaying=!0,this._processAudioBin()}_pause(){this._isPlaying=!1}_onResize(){}_dblClick(t){document.fullscreenElement?(document.exitFullscreen(),this._renderTo.style.position=this._parentDimension.position,this._renderTo.style.height=this._parentDimension.height,this._renderTo.style.width=this._parentDimension.width,this._renderTo.style.zIndex=this._parentDimension.zIndex,this._parentDimension={position:null,height:null,width:null,zIndex:null}):(document.documentElement.requestFullscreen(),this._parentDimension={position:this._renderTo.style.position,height:this._renderTo.style.height,width:this._renderTo.style.width,zIndex:this._renderTo.style.zIndex||""},this._renderTo.style.position="fixed",this._renderTo.style.height="100vh",this._renderTo.style.width="100vw",this._renderTo.style.zIndex="999")}_clearCanvas(){this._canvasL.getContext("2d").clearRect(0,0,this._canvasL.width,this._canvasL.height),this._canvasR.getContext("2d").clearRect(0,0,this._canvasR.width,this._canvasR.height)}};var c=class extends d{constructor(t){super(t),this._colors={signal:t.colors&&t.colors.signal||a.defaultPrimaryColor};const e=t.colors&&t.colors.background||a.defaultBackgroundColor;!0===this._merged?this._canvas.style.backgroundColor=e:(this._canvasL.style.backgroundColor=e,this._canvasR.style.backgroundColor=e),this._updateDimensions()}_fillAttributes(t){super._fillAttributes(t),this._dimension={height:null,canvasHeight:null,width:null}}_buildUI(){super._buildUI(),!0===this._merged&&this._dom.container.removeChild(this._canvasR)}_onResize(){super._onResize(),this._updateDimensions()}_processAudioBin(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}_mergedStereoAnalysis(){let t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteTimeDomainData(t),n.drawOscilloscope(this._canvasL,{samples:this._nodes.analyser.frequencyBinCount,timeDomain:t,color:this._colors.signal})}_stereoAnalysis(){let t=new Uint8Array(this._nodes.analyserL.frequencyBinCount);this._nodes.analyserL.getByteTimeDomainData(t),n.drawOscilloscope(this._canvasL,{samples:this._nodes.analyserL.frequencyBinCount,timeDomain:t,color:this._colors.signal}),this._nodes.analyserR.getByteTimeDomainData(t),n.drawOscilloscope(this._canvasR,{samples:this._nodes.analyserR.frequencyBinCount,timeDomain:t,color:this._colors.signal})}_updateDimensions(){this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.width=this._renderTo.offsetWidth-2,this._dimension.canvasHeight=this._dimension.height/2,!0===this._merged?(this._canvasL.width=this._dimension.width,this._canvasL.height=2*this._dimension.canvasHeight):(this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight)}};var _=class extends d{constructor(t){super(t),this._updateDimensions(),this._createLogarithmicScaleHeights();!0===this._merged?this._canvasL.style.backgroundColor="black":(this._canvasL.style.backgroundColor="black",this._canvasR.style.backgroundColor="black")}_fillAttributes(t){super._fillAttributes(t),this._scaleType=t.scale||"linear",this._colorSmoothing=t.colorSmoothing||!1,this._canvasSpeed=1,this._bufferCanvas=null,this._bufferCtx=null,this._dom.settings=null,this._dom.settingsPanel=null,this._dimension={height:null,canvasHeight:null,width:null},this._logScale=[],this._settingsClicked=this._settingsClicked.bind(this),this._clickedElsewhere=this._clickedElsewhere.bind(this)}_buildUI(){super._buildUI(),this._bufferCanvas=document.createElement("CANVAS"),this._bufferCtx=this._bufferCanvas.getContext("2d"),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight,this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight,this._dom.settings=document.createElement("IMG"),this._dom.settings.classList.add("audio-spectrum-settings"),this._dom.settings.src="./assets/img/settings.svg",this._dom.settingsPanel=document.createElement("DIV"),this._dom.settingsPanel.classList.add("audio-spectrum-settings-panel"),this._dom.settingsPanel.innerHTML=`\n      <h3>Settings</h3>\n      <form>\n        <p class="legend">Scale:</p>\n        <label for="linear">Linear</label>\n        <input type="radio" id="id-linear" name="scale" value="linear" ${"linear"===this._scaleType?"checked":""}>\n        <label for="logarithmic">Logarithmic</label>\n        <input type="radio" id="id-logarithmic" name="scale" value="logarithmic" ${"logarithmic"===this._scaleType?"checked":""}>\n        <p class="smooth-color">\n          <label for="smoothColor">Smooth colors</label>\n          <input type="checkbox" id="smoothColor" name="smoothColor" ${this._colorSmoothing?"checked":""}>\n        </p>\n      </form>\n    `;const t=this._dom.settingsPanel.querySelector("form");t.addEventListener("change",e=>{e.preventDefault();const i=new FormData(t),s=[];for(const t of i)s.push(t[1]);this._scaleType=s[0],"on"===s[1]?this._colorSmoothing=!0:this._colorSmoothing=!1},!1),this._dom.container.appendChild(this._dom.settingsPanel),this._dom.container.appendChild(this._dom.settings),this._dom.settings.addEventListener("click",this._settingsClicked,!1)}_removeEvents(){super._removeEvents(),document.body.removeEventListener("click",this._clickedElsewhere,!1)}_updateDimensions(){this._dimension.width=this._renderTo.offsetWidth-2,!0===this._merged?(this._dimension.height=this._renderTo.offsetHeight-2,this._dimension.canvasHeight=this._dimension.height):(this._dimension.height=this._renderTo.offsetHeight-4,this._dimension.canvasHeight=this._dimension.height/2)}_settingsClicked(){!1===this._dom.settingsPanel.classList.contains("opened")&&(this._dom.settings.classList.add("opened"),this._dom.settingsPanel.classList.add("opened"),document.body.addEventListener("click",this._clickedElsewhere,!1))}_clickedElsewhere(t){t.target.closest(".audio-spectrum-settings")||t.target.closest(".audio-spectrum-settings-panel")||(this._dom.settings.classList.remove("opened"),this._dom.settingsPanel.classList.remove("opened"),document.body.removeEventListener("click",this._clickedElsewhere,!1))}_processAudioBin(t){!0===this._isPlaying&&(!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}_mergedStereoAnalysis(){const t=new Uint8Array(this._nodes.analyser.frequencyBinCount);this._nodes.analyser.getByteFrequencyData(t),this._drawSpectrogramForFrequencyBin(this._canvasL,t)}_stereoAnalysis(){const t=new Uint8Array(this._nodes.analyserL.frequencyBinCount),e=new Uint8Array(this._nodes.analyserR.frequencyBinCount);this._nodes.analyserL.getByteFrequencyData(t),this._nodes.analyserR.getByteFrequencyData(e),this._drawSpectrogramForFrequencyBin(this._canvasL,t),this._drawSpectrogramForFrequencyBin(this._canvasR,e)}_drawSpectrogramForFrequencyBin(t,e){const i=t.getContext("2d");this._bufferCtx.drawImage(t,0,0,this._dimension.width,this._dimension.canvasHeight);for(let t=0;t<e.length;++t)"linear"===this._scaleType?this._fillRectLinear(i,e,t):this._fillRectLogarithm(i,e,t);i.translate(-this._canvasSpeed,0),i.drawImage(this._bufferCanvas,0,0,this._dimension.width,this._dimension.canvasHeight,0,0,this._dimension.width,this._dimension.canvasHeight),i.setTransform(1,0,0,1,0,0)}_fillRectLinear(t,e,i){const s=this._scaleLinearIndexToHeight(i),a=this._dimension.canvasHeight/e.length;if(0!==i&&this._colorSmoothing){const n=t.createLinearGradient(0,this._dimension.canvasHeight-s-a,0,this._dimension.canvasHeight-s);n.addColorStop(0,`rgb(${e[i]}, ${e[i]}, ${e[i]})`),n.addColorStop(1,`rgb(${e[i-1]}, ${e[i-1]}, ${e[i-1]})`),t.fillStyle=n}else t.fillStyle=`rgb(${e[i]}, ${e[i]}, ${e[i]})`;t.fillRect(this._dimension.width-this._canvasSpeed,this._dimension.canvasHeight-s-a,this._canvasSpeed,a)}_fillRectLogarithm(t,e,i){if(0!==i&&i!==e.length-1&&this._colorSmoothing){const s=t.createLinearGradient(0,this._logScale[i],0,this._logScale[i-1]);s.addColorStop(0,`rgb(${e[i]}, ${e[i]}, ${e[i]})`),s.addColorStop(1,`rgb(${e[i-1]}, ${e[i-1]}, ${e[i-1]})`),t.fillStyle=s}else t.fillStyle=`rgb(${e[i]}, ${e[i]}, ${e[i]})`;t.fillRect(this._dimension.width-this._canvasSpeed,this._logScale[i-1],this._canvasSpeed,this._logScale[i]-this._logScale[i-1])}_scaleLinearIndexToHeight(t){const e=this._fftSize/2;return t*this._dimension.canvasHeight/e}_createLogarithmicScaleHeights(){return new Promise(t=>{this._logScale=[this._dimension.canvasHeight];for(let t=1;t<this._fftSize/2;++t)this._logScale.push(this._computeLogSampleHeight(t));t()})}_computeLogSampleHeight(t){return this._dimension.canvasHeight-Math.log(t)/Math.log(10)/(Math.log(this._fftSize/2)/Math.log(10))*this._dimension.canvasHeight}_onResize(){super._onResize(),this._updateDimensions(),this._createLogarithmicScaleHeights(),this._canvasL.width=this._dimension.width,this._canvasL.height=this._dimension.canvasHeight,!1===this._merged&&(this._canvasR.width=this._dimension.width,this._canvasR.height=this._dimension.canvasHeight),this._bufferCanvas.width=this._dimension.width,this._bufferCanvas.height=this._dimension.canvasHeight}};var u=class extends d{constructor(t){super(t),this._peakGradient=[{color:t.colors&&t.colors.min||a.defaultAudioGradient[0],center:0},{color:t.colors&&t.colors.step0||a.defaultAudioGradient[1],center:.7},{color:t.colors&&t.colors.step1||a.defaultAudioGradient[2],center:.833},{color:t.colors&&t.colors.step2||a.defaultAudioGradient[3],center:.9},{color:t.colors&&t.colors.max||a.defaultAudioGradient[4],center:1}];const e=t.colors&&t.colors.background||a.defaultBackgroundColor;!0===this._merged?this._canvasL.style.backgroundColor=e:(this._canvasL.style.backgroundColor=e,this._canvasR.style.backgroundColor=e)}_fillAttributes(t){super._fillAttributes(t),this._orientation=t.orientation||"horizontal",this._legend=t.legend||null,this._legend?(this._dbScaleMin=t.legend.dbScaleMin||60,this._dbScaleTicks=t.legend.dbScaleTicks||15):(this._dbScaleMin=60,this._dbScaleTicks=15),this._amplitudeL=0,this._amplitudeR=0,this._peakL=0,this._peakR=0,this._peakSetTimeL=null,this._peakSetTimeR=null,this._dom.scaleContainer=null,this._dom.labels=[]}_buildUI(){super._buildUI(),"horizontal"===this._orientation&&this._dom.container.classList.add("horizontal-peakmeter"),this._legend&&(this._dom.scaleContainer=document.createElement("DIV"),this._dom.scaleContainer.classList.add("scale-container"),this._dom.container.insertBefore(this._dom.scaleContainer,this._dom.container.firstChild)),!0===this._merged&&this._dom.container.removeChild(this._canvasR),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}_setAudioNodes(){super._setAudioNodes(),this._peakSetTimeL=this._audioCtx.currentTime,this._peakSetTimeR=this._audioCtx.currentTime}_pause(){super._pause(),this._legend&&(this._dom.labels[0].textContent="-∞",this._dom.labels[1].textContent="-∞")}_onResize(){super._onResize(),this._updateDimensions(),this._legend&&(this._createPeakLabel(),this._createScaleTicks())}_processAudioBin(){!0===this._isPlaying&&(this._clearCanvas(),!0===this._merged?this._mergedStereoAnalysis():this._stereoAnalysis(),requestAnimationFrame(this._processAudioBin))}_mergedStereoAnalysis(){const t=new Float32Array(this._fftSize);this._nodes.analyser.getFloatTimeDomainData(t);let e=0;for(let i=0;i<t.length;i++)e+=t[i]**2;const i=10*Math.log10(e/t.length),s=-1*this._dbScaleMin;"horizontal"===this._orientation?this._amplitudeL=Math.floor(i*this._canvasL.width/s):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(i*this._canvasL.height/s)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&i!==-1/0&&(this._dom.labels[0].textContent=n.precisionRound(i,1))),n.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient})}_stereoAnalysis(){const t=new Float32Array(this._fftSize),e=new Float32Array(this._fftSize);this._nodes.analyserL.getFloatTimeDomainData(t),this._nodes.analyserR.getFloatTimeDomainData(e);let i=0,s=0;for(let a=0;a<t.length;a++)i+=t[a]**2,s+=e[a]**2;const a=10*Math.log10(i/t.length),o=10*Math.log10(s/e.length),r=-1*this._dbScaleMin;"horizontal"===this._orientation?(this._amplitudeL=Math.floor(a*this._canvasL.width/r),this._amplitudeR=Math.floor(o*this._canvasR.width/r)):"vertical"===this._orientation&&(this._amplitudeL=Math.floor(a*this._canvasL.height/r),this._amplitudeR=Math.floor(o*this._canvasR.height/r)),(this._peakL>this._amplitudeL||this._audioCtx.currentTime-this._peakSetTimeL>1)&&(this._peakL=this._amplitudeL,this._peakSetTimeL=this._audioCtx.currentTime,this._legend&&a!==-1/0&&(this._dom.labels[0].textContent=n.precisionRound(a,1))),this._peakR>this._amplitudeR?(this._peakR=this._amplitudeR,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&o!==-1/0&&(this._dom.labels[1].textContent=n.precisionRound(o,1))):this._audioCtx.currentTime-this._peakSetTimeR>1&&(this._peakR=this._amplitudeL,this._peakSetTimeR=this._audioCtx.currentTime,this._legend&&o!==-1/0&&(this._dom.labels[1].textContent=n.precisionRound(o,1))),n.drawPeakMeter(this._canvasL,{amplitude:this._amplitudeL,peak:this._peakL,orientation:this._orientation,colors:this._peakGradient}),n.drawPeakMeter(this._canvasR,{amplitude:this._amplitudeR,peak:this._peakR,orientation:this._orientation,colors:this._peakGradient})}_createScaleTicks(){const t=Math.floor(this._dbScaleMin/this._dbScaleTicks);let e=0;if(this._dom.scaleContainer.innerHTML="","horizontal"===this._orientation){const i=this._canvasL.width/t;for(let s=0;s<t;++s){const t=document.createElement("DIV");this._dom.scaleContainer.appendChild(t),t.style.width=i+"px",t.textContent=""+e,e-=this._dbScaleTicks}}else{const i=this._canvasL.height/t;for(let s=0;s<t;++s){const t=document.createElement("DIV");this._dom.scaleContainer.appendChild(t),t.style.height=i+"px",t.textContent=""+e,e-=this._dbScaleTicks}}}_createPeakLabel(){2===this._dom.labels.length&&(this._dom.container.removeChild(this._dom.labels[0]),this._dom.container.removeChild(this._dom.labels[1]),this._dom.labels=[]);const t=document.createElement("DIV"),e=document.createElement("DIV");t.classList.add("peak-value-container"),e.classList.add("peak-value-container"),t.textContent="-∞",e.textContent="-∞","horizontal"===this._orientation?(t.style.width="28px",t.style.height=this._canvasL.height+2+"px",t.style.top="14px",e.style.width="28px",e.style.height=this._canvasL.height+2+"px",e.style.top=this._canvasL.height+16+"px"):(t.style.width=this._canvasL.width+2+"px",t.style.left="18px",e.style.width=this._canvasL.width+2+"px",e.style.left=this._canvasL.width+20+"px"),this._dom.labels.push(t),this._dom.labels.push(e),this._dom.container.appendChild(this._dom.labels[0]),this._dom.container.appendChild(this._dom.labels[1])}_updateDimensions(){let t=0,e=0;"horizontal"===this._orientation?(this._legend&&(t=30,e=14),this._canvasL.width=this._renderTo.offsetWidth-t,!0===this._merged?(this._canvasL.height=this._renderTo.offsetHeight-e-2,this._canvasR.height=this._renderTo.offsetHeight-e-2):(this._canvasR.width=this._renderTo.offsetWidth-t,this._canvasL.height=(this._renderTo.offsetHeight-e)/2-2,this._canvasR.height=(this._renderTo.offsetHeight-e)/2-2),this._legend&&(this._dom.scaleContainer.style.width=this._canvasL.width+"px")):"vertical"===this._orientation&&(this._legend?(t=18,e=16):this._canvasL.style.left=0,this._canvasL.height=this._renderTo.offsetHeight-e-2,!0===this._merged?(this._canvasL.width=this._renderTo.offsetWidth-t-2,this._canvasR.width=this._renderTo.offsetWidth-t-2):(this._canvasR.height=this._renderTo.offsetHeight-e-2,this._canvasL.width=(this._renderTo.offsetWidth-t)/2-2,this._canvasR.width=(this._renderTo.offsetWidth-t)/2-2),this._legend&&(this._dom.scaleContainer.style.height=this._canvasL.height+"px",this._dom.scaleContainer.style.width="18px"))}};var g=class extends s{constructor(t){super(t),this._colors={background:t.colors&&t.colors.background||a.defaultBackgroundColor,track:t.colors&&t.colors.track||a.defaultTextColor,progress:t.colors&&t.colors.progress||a.defaultPrimaryColor},this._canvas.style.backgroundColor=this._colors.background,""!==this._player.src&&this._getPlayerSourceFile()}_fillAttributes(t){super._fillAttributes(t),this._animation=t.animation,this._wave={align:t.wave&&t.wave.align||"center",barWidth:t.wave&&t.wave.barWidth||1,barMarginScale:t.wave?t.wave.barMarginScale/2:.125,merged:t.wave&&t.wave.merged||!0},this._bars=null,this._offlineCtx=null,this._offlineBuffer=null,this._dataL=[],this._dataR=[],this._trackLoaded=this._trackLoaded.bind(this),this._seekPlayer=this._seekPlayer.bind(this)}_buildUI(){super._buildUI(),this._bars=this._canvas.width/this._wave.barWidth}_addEvents(){super._addEvents(),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._dom.container.addEventListener("click",this._seekPlayer,!1)}_removeEvents(){super._removeEvents(),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._dom.container.removeEventListener("click",this._seekPlayer,!1)}_onResize(){super._onResize(),this._bars=this._canvas.width/this._wave.barWidth,this._fillData(),this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}_dblClick(){}_trackLoaded(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}_seekPlayer(t){const e=t.target.getBoundingClientRect(),i=t.clientX-e.left;this._player.currentTime=i/this._canvas.width*this._player.duration,this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}_processAudioFile(t){this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,t=>{this._offlineSource.buffer=t,this._offlineSource.connect(this._offlineCtx.destination),this._offlineSource.start(),this._offlineCtx.startRendering().then(t=>{this._offlineBuffer=t,this._fillData(),this._drawFileWaveform(this._player.currentTime/this._player.duration)}).catch((function(t){console.log("Rendering failed: "+t)}))})}_fillData(){this._offlineBuffer&&(!0===this._wave.merged?this._dataL=this._genScaledMonoData(this._offlineBuffer):(this._dataL=this._genScaledData(this._offlineBuffer.getChannelData(0)),this._dataR=this._genScaledData(this._offlineBuffer.getChannelData(1))))}_genScaledData(t){const e=Math.floor(t.length/this._bars),i=[];for(let s=0;s<=t.length-e;s+=e){let a=0;for(let i=0;i<e;++i)a+=Math.abs(t[s+i]);i.push(a/e)}return this._scaleDataToHeight(i)}_genScaledMonoData(t){const e=t.getChannelData(0),i=t.getChannelData(1),s=Math.floor(e.length/this._bars),a=[];for(let t=0;t<=e.length-s;t+=s){let n=0;for(let a=0;a<s;++a)n+=(Math.abs(e[t+a])+Math.abs(i[t+a]))/2;a.push(n/s)}return this._scaleDataToHeight(a)}_scaleDataToHeight(t){const e=Math.max(...t),i=Math.min(...t),s=e-i,a=.9*this._canvas.height;let n=[];for(let e=0;e<t.length;++e)n.push((t[e]-i)*a/s);return n}_drawFileWaveform(t){var e=this._canvas.width/this._bars;const i=e*this._wave.barMarginScale;this._ctx.beginPath();for(let s=0;s<this._dataL.length;++s){const n=this._dataL[s]/2,o=!0===this._wave.merged?this._dataL[s]/2:this._dataR[s]/2;if(this._ctx.fillStyle=this._colors.track,e*(s+1)/this._canvas.width>t&&e*s/this._canvas.width<t){const n=this._ctx.createLinearGradient(e*s+i,0,e*(s+1)-i,0);let o=e*(s+1)-e*s,r=t*this._canvas.width,h=Math.abs(r-e*s)/o;if("gradient"===this._animation)h+.01<1?(n.addColorStop(0,this._colors.progress),n.addColorStop(h,this._colors.progress),n.addColorStop(h+.01,this._colors.track),n.addColorStop(1,this._colors.track),this._ctx.fillStyle=n):this._ctx.fillStyle=this._colors.progress;else{const t=Math.round(255*h);this._ctx.fillStyle=a.lightenDarkenColor(this._colors.progress,255-t)}}else s/this._dataL.length<t&&(this._ctx.fillStyle=this._colors.progress);"center"===this._wave.align?(this._ctx.fillRect(e*s+i,this._canvas.height/2-n,e-2*i,n),this._ctx.fillRect(e*s+i,this._canvas.height/2,e-2*i,o),this._ctx.fillRect(e*s+i,this._canvas.height/2-.15,e-2*i,.15)):"bottom"===this._wave.align?(this._ctx.fillRect(e*s+i,this._canvas.height-n,e-2*i,n),this._ctx.fillRect(e*s+i,this._canvas.height-n-o+1,e-2*i,o)):"top"===this._wave.align&&(this._ctx.fillRect(e*s+i,0,e-2*i,n),this._ctx.fillRect(e*s+i,n-1,e-2*i,o))}this._ctx.closePath()}_getPlayerSourceFile(){const t=new XMLHttpRequest;t.open("GET",this._player.src,!0),t.responseType="arraybuffer",t.onload=()=>{this._processAudioFile(t.response)},t.send()}_processAudioBin(){!0===this._isPlaying&&(this._clearCanvas(),this._drawFileWaveform(this._player.currentTime/this._player.duration),requestAnimationFrame(this._processAudioBin))}};var m=class extends s{constructor(t){super(t),this._colors={background:t.colors&&t.colors.background||a.defaultBackgroundColor,track:t.colors&&t.colors.track||a.defaultDarkPrimaryColor,mainBeat:t.colors&&t.colors.mainBeat||a.defaultPrimaryColor,subBeat:t.colors&&t.colors.subBeat||a.defaultAntiPrimaryColor},this._canvas.style.backgroundColor=this._colors.background,this._canvasSpeed=t.speed?t.speed:5,this._beat={offset:t.beat?t.beat.offset:null,bpm:t.beat?t.beat.bpm:null,timeSignature:t.beat?t.beat.timeSignature:null},this._canvases=[],this._isDragging=!1,this._wasPlaying=!1,this._draggedTime=0,this._startDrag={x:0,y:0},""!==this._player.src&&this._getPlayerSourceFile()}_fillAttributes(t){super._fillAttributes(t),this._offlineCtx=null,this._offlineBuffer=null,this._trackLoaded=this._trackLoaded.bind(this),this._onProgress=this._onProgress.bind(this),this._mouseDown=this._mouseDown.bind(this),this._mouseMove=this._mouseMove.bind(this),this._mouseUp=this._mouseUp.bind(this)}_addEvents(){super._addEvents(),this._player.addEventListener("loadedmetadata",this._trackLoaded,!1),this._player.addEventListener("seeking",this._onProgress,!1),this._canvas.addEventListener("mousedown",this._mouseDown,!1)}_removeEvents(){super._removeEvents(),this._player.removeEventListener("loadedmetadata",this._trackLoaded,!1),this._player.removeEventListener("seeking",this._onProgress,!1)}_onResize(){super._onResize(),this._fillData(),this._clearCanvas(),this._drawTimeline(this._player.currentTime)}_dblClick(){}_trackLoaded(){cancelAnimationFrame(this._processAudioBin),this._clearCanvas(),this._getPlayerSourceFile()}_onProgress(){this._clearCanvas(),this._drawTimeline(this._player.currentTime||0)}_mouseDown(t){this._isDragging=!0,this._startDrag.x=t.clientX,this._startDrag.y=t.clientY,!1===this._player.paused&&(this._wasPlaying=!0,this._player.pause()),this._canvas.addEventListener("mousemove",this._mouseMove,!1),this._canvas.addEventListener("mouseup",this._mouseUp,!1),this._canvas.addEventListener("mouseout",this._mouseUp,!1)}_mouseMove(t){if(!0===this._isDragging){const e=(this._startDrag.x-t.clientX)*this._canvasSpeed/this._canvas.width*2;this._draggedTime=this._player.currentTime+e,this._clearCanvas(),this._drawTimeline(this._draggedTime)}}_mouseUp(t){this._isDragging=!1,this._startDrag.x=0,this._startDrag.y=0,this._player.currentTime=this._draggedTime||this._player.currentTime,this._draggedTime=null,!0===this._wasPlaying&&(this._wasPlaying=!1,this._player.play()),this._canvas.removeEventListener("mousemove",this._mouseMove,!1),this._canvas.removeEventListener("mouseup",this._mouseUp,!1),this._canvas.removeEventListener("mouseout",this._mouseUp,!1)}_processAudioFile(t){this._offlineCtx=new OfflineAudioContext(2,this._audioCtx.sampleRate*this._player.duration,this._audioCtx.sampleRate),this._offlineSource=this._offlineCtx.createBufferSource(),this._audioCtx.decodeAudioData(t,t=>{this._offlineSource.buffer=t,this._offlineSource.connect(this._offlineCtx.destination),this._offlineSource.start(),this._offlineCtx.startRendering().then(t=>{this._offlineBuffer=t,this._fillData(),this._drawTimeline(this._player.currentTime||0)}).catch((function(t){console.log("Rendering failed: "+t)}))})}_fillData(){if(this._offlineBuffer){this._canvases=[];const t=this._genScaledMonoData(this._offlineBuffer),e=this._canvasSpeed*this._offlineBuffer.sampleRate/this._canvas.width,i=Math.floor(this._offlineBuffer.duration/this._canvasSpeed*this._canvas.width),s=this._beat.offset/this._canvasSpeed*this._canvas.width,n=Math.floor(1/(this._beat.bpm/60)/this._canvasSpeed*this._canvas.width);let o=0,r=!1;for(let h=0;h<i;h+=32e3){const l=document.createElement("canvas"),d=l.getContext("2d"),c=i-h;l.width=c>32e3?32e3:c,l.height=this._canvas.height,d.clearRect(0,0,i,this._canvas.height);for(let i=0;i<c;++i){const c=Math.floor((h+i)*e);let _=0;for(let i=0;i<e;++i)t[c+i]>_&&(_=t[c+i]);d.fillStyle=a.lightenDarkenColor(this._colors.track,100*_),_=Math.floor(_*(.9*this._canvas.height/2)),d.fillRect(i,this._canvas.height/2,1,-_),d.fillRect(i,this._canvas.height/2,1,+_),d.fillRect(h+i,this._canvas.height/2-.5,1,1),null!==this._beat.bpm&&null!==this._beat.offset&&i>=Math.floor(s)&&(!1===r?(r=!0,this._drawBeatBar(o,l,d,i),++o):(i-Math.floor(s))%n==0&&(this._drawBeatBar(o,l,d,i),++o))}this._canvases.push(l)}}}_drawBeatBar(t,e,i,s){t%this._beat.timeSignature==0?i.fillStyle="white":i.fillStyle="grey",i.fillRect(s,9,1,this._canvas.height-18),t%this._beat.timeSignature==0?i.fillStyle=this._colors.mainBeat:i.fillStyle=this._colors.subBeat,n.drawTriangle(e,s,4,6,12),n.drawTriangle(e,s,this._canvas.height-4,6,this._canvas.height-12)}_genScaledMonoData(t){const e=t.getChannelData(0),i=t.getChannelData(1),s=[];for(let t=0;t<e.length;++t)s.push((Math.abs(e[t])+Math.abs(i[t]))/2);return s}_drawTimeline(t){const e=Math.floor(t*this._canvas.width/this._canvasSpeed);let i=Math.floor((e-this._canvas.width/2)/32e3);i<0&&(i=0);let s=Math.floor((e+this._canvas.width/2)/32e3);s>=this._canvases.length&&(s=this._canvases.length-1);for(let t=i;t<=s;++t)this._ctx.drawImage(this._canvases[t],this._canvas.width/2-e+32e3*t,0);this._ctx.fillStyle=a.defaultAntiPrimaryColor,this._ctx.fillRect(this._canvas.width/2,3,3,this._canvas.height-6),this._ctx.strokeStyle="black",this._ctx.lineWidth=1,this._ctx.strokeRect(this._canvas.width/2,3,3,this._canvas.height-6)}_getPlayerSourceFile(){const t=new XMLHttpRequest;t.open("GET",this._player.src,!0),t.responseType="arraybuffer",t.onload=()=>{this._processAudioFile(t.response)},t.send()}_processAudioBin(){!0===this._isPlaying&&(this._clearCanvas(),this._drawTimeline(this._player.currentTime),requestAnimationFrame(this._processAudioBin))}updateBeatInfo(t){this._beat={offset:t.offset,bpm:t.bpm,timeSignature:t.timeSignature}}};window.AudioContext=window.AudioContext||window.webkitAudioContext;class p{constructor(t){return"frequencybars"===t.type?new o(t):"frequencycircle"===t.type?new l(t):"oscilloscope"===t.type?new c(t):"spectrum"===t.type?new _(t):"peakmeter"===t.type?new u(t):"waveformprogress"===t.type?new g(t):"timeline"===t.type?new m(t):null}}window.AudioVisualizer=p;e.default=p}]);